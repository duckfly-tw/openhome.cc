<!doctype html><html lang="en-us">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="XML is used to represent structured data, but dealing with XML DOM is complex. In a web application,...">

<meta property="og:locale" content="en_US">
<meta property="og:title" content="Dealing with JSON">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/eGossip/Blog/JSON.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="XML is used to represent structured data, but dealing with XML DOM is complex. In a web application,...">


    <title>Dealing with JSON</title>

<link rel="stylesheet" href="http://openhome.cc/Gossip/css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../../Gossip/css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="http://openhome.cc/Gossip/css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="http://openhome.cc/Gossip/css/caterpillar.css">
     <script async src="http://openhome.cc/Gossip/google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="JSON.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">&lt;&lt; JavaScript TOC</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../../Gossip/images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../../Gossip/images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>Dealing with JSON</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
      
      <br>
      XML is used to represent structured data, but dealing with XML DOM is complex. In a web application, data are not always so complex that we really need XML. If that's so, JSON may be used for data interchange. <br>
      <br>
      JSON stands for "JavaScript Object Notation". It is based on a subset of JavaScript object literals. You can find complete description of JSON structures in <a

        href="http://www.json.org/">http://www.json.org</a>. In general, JSON is similar to object literals. The primary differences include:<br>
      <ul>
        <li>A name is a double-quoted Unicode string with backslash escaping.</li>
        <li>A value can be a string in double quotes, or a number, <span

            class="courier">true</span>, <span class="courier">false</span>, <span

            class="courier">null</span>, an object or an array.</li>
        <li>Several JavaScript data types, such as <span class="courier">Date</span>, <span

            class="courier">Error</span>, <span class="courier">RegExp</span>, and <span

            class="courier">Function</span>, are not included. </li>
      </ul>
      For example, the following is an object literal: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>var obj = {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; name : 'Justin',</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; age : 35,</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; childs : [ { name : 'hamimi', age : 3} ]</strong></span><span><strong><br>
          </strong></span><span><strong>};</strong></span></div>
      <br>
      The following is its JSON representation: <br>
      <div style="margin-left: 40px;"><span><strong class="courier">var json = '{"name": "Justin", "age": 35, "childs": [{"name": "hamimi", "age": 3}]}';</strong></span><span><strong><br>
          </strong></span></div>
      <br>
      Format the above for readability: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>{</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; "name":"Justin",</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; "age":35,</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; "childs":[</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "name":"hamimi",</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "age":3</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; ]</strong></span><span><strong><br>
          </strong></span><span><strong>}</strong></span></div>
      <br>
      You can send a JSON string to the server. Creating a JSON string is easy. Firefox 3.1, Internet Explorer and newer browsers have a simple JSON library. Creating a JSON string from an object just needs the <span

        class="courier">JSON.stringify</span> function. For example: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>var obj = {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; name : 'Justin',</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; age : 35,</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; childs : [ { name : 'hamimi', age : 3} ]</strong></span><span><strong><br>
          </strong></span><span><strong>};</strong></span><span><strong><br>
          </strong></span><span><strong>var json = JSON.stringify(obj);</strong></span><strong><br>
        </strong></div>
      <br>
      Then, you can get a JSON string as shown previously. Sending JSON through an asynchronous object can be as follows: <br>
      <div class="courier" style="margin-left: 40px;"><strong><span>var request = xhr(); // xhr() returns an asyhcnronous object</span></strong><strong><span><br>
          </span></strong><strong><span>request.onreadystatechange = handleStateChange; // handleStateChange is a function</span></strong><strong><span><br>
          </span></strong><strong><span>request.open('POST', url);</span></strong><strong><span><br>
          </span></strong><strong><span>request.setRequestHeader('Content-Type', 'application/json');</span></strong><strong><span><br>
          </span></strong><strong><span>request.send(json);</span></strong></div>
      <br>
      It's recommended to set the request header <span class="courier">'Content-Type'</span> as <span

        class="courier">'application/json'</span>. Of course, the server has to parse the JSON string. You don't need to write one by yourself. The site <a

        href="http://www.json.org/">http://www.json.org</a> provides JSON parsers with different language implementations to help you with parsing a JSON string. <br>
      <br>
      When a server sends a JSON string, you can use the <span class="courier">eval</span> function to convert the JSON string into a JavaScript object. For example: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>var obj = eval(json);</strong></span></div>
      <br>
      The <span class="courier">eval</span> function, however, can also evaluate JavaScript expressions or execute JavaScript statements. If you just want to parse a JSON string into an object, the <span

        class="courier">JSON.parse</span> function is recommended. For example: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>var obj = JSON.parse(json);</strong></span></div>
      <br>
      For browsers before Firefox 3.1, Internet Explorer 8, or those without built-in JSON supports, you can download json2.js from <a

        href="http://www.json.org">http://www.json.org</a> (and other files. see the README for details). Embed the script file in your page; you'll have the methods mentioned previously: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>&lt;script type="text/javascript" src="json2.js"&gt;</strong></span></div>
      <br>
      If a browser has built-in JSON supports, json2.js does nothing. The following is a demonstration of using JSON. It provides a list of suggested terms. (The server isn't really a search engine.)&nbsp; If there're suggested terms, a JSON-formatted string array is sent, such as <span

        class="courier">'["caterpillar", "ceo"]'</span>. (The server's suggested terms include <span

        class="courier">"caterpillar"</span>, <span class="courier">"car"</span>, <span

        class="courier">"ceo"</span>, <span class="courier">"c++"</span>, <span

        class="courier">"justin"</span>, <span class="courier">"java"</span>, and <span

        class="courier">"javascript"</span>.) You have to know the exact position of the input box to align suggested terms under it. You can see how to do this in the third example of <a

        href="ElementPositions.html">Element Positions</a>. <br>
      <ul>
        <li><a href="samples/JSON-1.html">JSON-1.html</a></li>
      </ul>
      <pre class="prettyprint"><code lang="javascript">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta content="text/html; charset=UTF-8" http-equiv="content-type"&gt;
        &lt;style type="text/css"&gt;
            div {
                color: #ffffff;
                background-color: #ff0000;
                border-width: 1px;
                border-color: black;
                border-style: solid;
                position: absolute;
            }        
        &lt;/style&gt;
        &lt;script type="text/javascript" src="js/json2.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript"&gt;
            window.onload = function() {
                function offset(element) {
                    var x = 0;
                    var y = 0;
                    while(element) {
                        x += element.offsetLeft;
                        y += element.offsetTop;
                        element = element.offsetParent;
                    }
                    return { 
                        x: x, 
                        y: y, 
                        toString: function() {
                            return '(' + this.x + ', ' + this.y + ')';
                        }
                    };
                }
                var xhr = window.XMLHttpRequest &amp;&amp; 
                      (window.location.protocol !== 'file:' 
                          || !window.ActiveXObject) ?
                       function() {
                           return new XMLHttpRequest();
                       } :
                       function() {
                          try {
                             return new ActiveXObject('Microsoft.XMLHTTP');
                          } catch(e) {
                             throw new Error('XMLHttpRequest not supported');
                          }
                       };
                
                function param(obj) {
                    var pairs = [];
                    for(var name in obj) {
                        var pair = encodeURIComponent(name) + '=' + 
                                   encodeURIComponent(obj[name]);
                        pairs.push(pair.replace('/%20/g', '+'));
                    }
                    return pairs.join('&amp;');
                }
                
                function ajax(option) {
                    option.type = option.type || 'GET';
                    option.header = option.header || {
                      'Content-Type':'application/x-www-form-urlencoded'};
                    option.callback = option.callback || function() {};
                    
                    if(!option.url) {
                        return;
                    }
                    
                    var request = xhr();
                    request.onreadystatechange = function() {
                        option.callback.call(request, request);
                    };
                    
                    var body = null;
                    var url = option.url;
                    if(option.data) {
                        if(option.type === 'POST') {
                            body = param(option.data);
                        }
                        else {
                            url = option.url + '?' + param(option.data) 
                                     + '&amp;time=' + new Date().getTime();
                        }
                    }
                    
                    request.open(option.type, url);
                    for(var name in option.header) {
                        request.setRequestHeader(
                                name, option.header[name]);
                    }
                    request.send(body);
                }
                var search = document.getElementById('search');
                search.onkeyup = function() {
                    var divs = document.getElementsByTagName('div');
                    for(var i = 0; i &lt; divs.length; i++) {
                        document.body.removeChild(divs[i]);
                    }
                    if(search.value === '') {
                        return;
                    }
                    ajax({
                        url     : 'JSON-1.php',
                        data    : {keyword : search.value},
                        callback: function(request) {
                            if(request.readyState === 4) {
                                if(request.status === 200) {
                                    var keywords = JSON.parse(
                                            request.responseText);
                                    if(keywords.length !== 0) {
                                        var innerHTML = '';
                                        for(var i = 0; 
                                              i &lt; keywords.length; i++) {
                                            innerHTML += 
                                                (keywords[i] + '&lt;br&gt;');
                                        }
                                        var div = 
                                              document.createElement('div');
                                        div.innerHTML = innerHTML;
                                        var xy = offset(search);
                                        div.style.left = xy.x + 'px';
                                        div.style.top = 
                                             xy.y + search.offsetHeight + 'px';
                                        div.style.width = 
                                             search.offsetWidth + 'px';
                                        document.body.appendChild(div);
                                    }
                                    
                                }
                            }
                        }
                    });
                };
            };
        &lt;/script&gt;        
    &lt;/head&gt;
    &lt;body&gt;
        &lt;hr&gt;
        Search: &lt;input id="search" type="text"&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
      <br>
      This example doesn't consider users' typing speed, so it'll send a request every one typing. To avoid problems of frequent requests due to users' rapid typing, you may try a time period setting, such as send a request every one second. <br>
      <br>
      In addition, for each suggested terms, you may provide a <span class="courier">click</span> event handler. When a user clicks a term, set its text in the input box, and then remove the <span

        class="courier">div</span> element. This is a practice left for you.<br>
      <div class="recommend" style="text-align: center;"><hr><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
    
        </article></main></div></body>
<script src="http://openhome.cc/Gossip/js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
