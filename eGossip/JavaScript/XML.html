<!doctype html><html lang="en-us">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="When using asynchronous objects to transfer complex structured data, you can use XML. Transferring X...">

<meta property="og:locale" content="en_US">
<meta property="og:title" content="Dealing with XML">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/eGossip/Blog/XML.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="When using asynchronous objects to transfer complex structured data, you can use XML. Transferring X...">


    <title>Dealing with XML</title>

<link rel="stylesheet" href="http://openhome.cc/Gossip/css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../../Gossip/css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="http://openhome.cc/Gossip/css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="http://openhome.cc/Gossip/css/caterpillar.css">
     <script async src="http://openhome.cc/Gossip/google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="XML.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">&lt;&lt; JavaScript TOC</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../../Gossip/images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../../Gossip/images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>Dealing with XML</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
      
      <br>
      When using asynchronous objects to transfer complex structured data, you can use XML. Transferring XML only needs to organize data into a string composed of XML format, use <span
        class="courier">'POST'</span> when calling the <span class="courier">open</span> function, set the <span
        class="courier">'Content-Type'</span> header as <span class="courier">'text/xml'</span>, and pass the XML string to the <span
        class="courier">send</span> function. The XML string will be put in the POST body when sending. For example:<br>
      <div class="courier" style="margin-left: 40px;"><span><strong>function toXML(data) {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; var xml = ['&lt;data&gt;'];</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; for(var name in data) {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xml.push('&lt;' + name + '&gt;');</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xml.push(data[name]);</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xml.push('&lt;/' + name + '&gt;');</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; }</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; xml.push('&lt;/data&gt;');</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; return xml.join('');</strong></span><span><strong><br>
          </strong></span><span><strong>}</strong></span><span><strong><br>
          </strong></span><span><strong><br>
          </strong></span><span><strong>...</strong></span><span><strong><br>
          </strong></span><span><strong>var data = { // data is actually provided by a user. </strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; x : 10,</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; y : 20,</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; z : 30</strong></span><span><strong><br>
          </strong></span><span><strong>};</strong></span><span><strong><br>
          </strong></span><span><strong>var request = xhr(); // xhr() returns an asynchronous object.</strong></span><span><strong><br>
          </strong></span><span><strong>request.onreadystatechange = handleStateChange; // handleStateChange refers to a functi</strong></span><span><strong>on.</strong></span><span><strong><br>
          </strong></span><span><strong>request.open('POST', url);</strong></span><span><strong><br>
          </strong></span><span><strong>request.setRequestHeader('Content-Type', 'text/xml');</strong></span><span><strong><br>
          </strong></span><span><strong>request.send(toXML(data));</strong></span><strong><br>
        </strong></div>
      <br>
      After running the above example, the server will receive the following XML string (formatted for readability).<br>
      <div class="courier" style="margin-left: 40px;"><span><strong>&lt;data&gt;</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; &lt;x&gt;10&lt;/x&gt;</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; &lt;y&gt;20&lt;/y&gt;</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; &lt;z&gt;30&lt;/z&gt;</strong></span><span><strong><br>
          </strong></span><span><strong>&lt;/data&gt;</strong></span></div>
      <br>
      Of course, the server should parse the XML string and dig out what it needs for processing. Here, I don't want to involve into how the server parses the XML string. <br>
      <br>
      When a server send a XML response, the client can use the asynchronous object's <span
        class="courier">responseXML</span> property to get the parsed DOM object, and then use DOM API to dig out what it needs for processing. For instance, the first example of <a
        href="GET.html">Making GET Requests</a> sets the returned XML string to the <span
        class="courier">div</span> element's <span class="courier">innerHTML</span>. This way limits the client's page design. The server can use a XML response to give the client free with page design. <br>
      <br>
      For example, if the server sends the following XML (Note that, the server should set the response header <span
        class="courier">'Content-Type'</span> as <span class="courier">'text/xml'</span>. If the XML contains non-ASCII characters, like Traditional Chinese characters, the <span
        class="courier">charset</span> property is also required.): <br>
      <div class="courier" style="margin-left: 40px;"><strong><span>&lt;?xml version="1.0" encoding="</span></strong><strong><span>utf-8</span></strong><strong><span>"?&gt;</span></strong><strong><span><br>
          </span></strong><strong><span>&lt;select&gt;</span></strong><strong><span><br>
          </span></strong><strong><span>&nbsp;&nbsp;&nbsp; &lt;option value="algorithm"&gt;Algorithm&lt;/option&gt;</span></strong><strong><span><br>
          </span></strong><strong><span>&nbsp;&nbsp;&nbsp; &lt;option value="graphic"&gt;Computer Graphics&lt;/option&gt;</span></strong><strong><span><br>
          </span></strong><strong><span>&nbsp;&nbsp;&nbsp; &lt;option value="pattern"&gt;Design Pattern&lt;/option&gt;</span></strong><strong><span><br>
          </span></strong><strong><span>&lt;/select&gt;</span></strong><strong><span><br>
          </span></strong></div>
      <br>
      The following example rewrites the first example of Making GET Requests. This time, it deals with a XML response. <br>
      <ul>
        <li><a href="samples/XML-1.html">XML-1.html</a></li>
      </ul>
      <pre class="prettyprint"><code lang="javascript">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta content="text/html; charset=UTF-8" http-equiv="content-type"&gt;
        &lt;script type="text/javascript"&gt;
            window.onload = function() {
                var xhr = window.XMLHttpRequest &amp;&amp; 
                      (window.location.protocol !== 'file:' 
                          || !window.ActiveXObject) ?
                       function() {
                           return new XMLHttpRequest();
                       } :
                       function() {
                          try {
                             return new ActiveXObject('Microsoft.XMLHTTP');
                          } catch(e) {
                             throw new Error('XMLHttpRequest not supported');
                          }
                       };
                
                function param(obj) {
                    var pairs = [];
                    for(var name in obj) {
                        var pair = encodeURIComponent(name) + '=' + 
                                   encodeURIComponent(obj[name]);
                        pairs.push(pair.replace('/%20/g', '+'));
                    }
                    return pairs.join('&amp;');
                }
                
                function ajax(option) {
                    option.type = option.type || 'GET';
                    option.header = option.header || {
                      'Content-Type':'application/x-www-form-urlencoded'};
                    option.callback = option.callback || function() {};
                    
                    if(!option.url) {
                        return;
                    }
                    
                    var request = xhr();
                    request.onreadystatechange = function() {
                        option.callback.call(request, request);
                    };
                    
                    var body = null;
                    var url = option.url;
                    if(option.data) {
                        if(option.type === 'POST') {
                            body = param(option.data);
                        }
                        else {
                            url = option.url + '?' + param(option.data) 
                                     + '&amp;time=' + new Date().getTime();
                        }
                    }
                    
                    request.open(option.type, url);
                    for(var name in option.header) {
                        request.setRequestHeader(
                                name, option.header[name]);
                    }
                    request.send(body);
                }
                
                document.getElementById('category').onchange = function() {
                    ajax({
                        url     : 'XML-1.php',
                        data    : {category : this.value},
                        callback: function(request) {
                            if(request.readyState === 4) {
                                if(request.status === 200) {
                                    var select = 
                                         document.createElement('select');
                                    var xml = request.responseXML;
                                    var options = 
                                         xml.getElementsByTagName('option');
                                    for(var i = 0; i &lt; options.length; i++) {
                                        var value = 
                                          options[i].getAttribute('value');
                                        // Note that, a text is also a node.
                                        var text = 
                                          options[i].firstChild.nodeValue;
                                        if(navigator.userAgent
                                            .indexOf('MSIE') === -1) {
                                            select.add(
                                             new Option(text, value), 
                                              select.options[
                                               select.options.length]);
                                        }
                                        else {
                                            select.add(
                                              new Option(text, value),
                                               select.options.length);
                                        }
                                    }
                                    var book = 
                                      document.getElementById('book');
                                    if(book.firstChild) {
                                        book.removeChild(book.firstChild);
                                    }
                                    book.appendChild(select);
                                }
                            }
                        }
                    });
                };
            };
        &lt;/script&gt;        
    &lt;/head&gt;
    &lt;body&gt;
        Book: &lt;br&gt;
        &lt;select id="category"&gt;
            &lt;option&gt;-- Category --&lt;/option&gt;
            &lt;option value="theory"&gt;Theory&lt;/option&gt;
            &lt;option value="language"&gt;Language&lt;/option&gt;
            &lt;option value="web"&gt;Web&lt;/option&gt;
        &lt;/select&gt;&lt;br&gt;&lt;br&gt;
        Buy: &lt;div id="book"&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
      <br>
      This example has the same functionality as the first example of <a
        href="GET.html">Making GET Requests</a>, yet the client can determine how to display the XML response. <br>
      <br>
      The above example also demonstrates how to deal with the difference between standards-compliant browsers and Internet Explorer when appending <span
        class="courier">option</span> elements to the <span class="courier">select</span> element. We can't use object detection here, because standards-compliant browser and Internet Explorer both have an <span
        class="courier">add</span> function. Their difference is the second parameter. Standards-compliant browsers need an existing option, and the new option will be appended after that. Internet Explorer needs an existing option's index, and the new option will be appended after it. <br>
      <br>
      Use object detection when possible. Here we can't do that, so use browser sniffing instead.<br>
     <div class="recommend" style="text-align: center;"><hr><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article></main></div></body>
<script src="http://openhome.cc/Gossip/js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
