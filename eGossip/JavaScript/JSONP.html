<!doctype html><html lang="en-us">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="In fact, using asynchronous objects isn't the only way to send asynchronous requests. Using iframe i...">

<meta property="og:locale" content="en_US">
<meta property="og:title" content="Function Declarations">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/eGossip/Blog/JSONP.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="In fact, using asynchronous objects isn't the only way to send asynchronous requests. Using iframe i...">


    <title>Function Declarations</title>

<link rel="stylesheet" href="http://openhome.cc/Gossip/css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../../Gossip/css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="http://openhome.cc/Gossip/css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="http://openhome.cc/Gossip/css/caterpillar.css">
     <script async src="http://openhome.cc/Gossip/google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="JSONP.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">&lt;&lt; JavaScript TOC</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../../Gossip/images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../../Gossip/images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>Function Declarations</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
      
      <br>
      In fact, using asynchronous objects isn't the only way to send asynchronous requests. Using <span

        class="courier">iframe</span> is an example; creating an <span

        class="courier">img</span> element and setting the <span class="courier">src</span> property makes browsers request the image; creating a <span

        class="courier">script</span> element and setting the <span class="courier">src</span> property is also workable. <br>
      <br>
      You can dynamically create a <span class="courier">script</span> element, set the <span

        class="courier">src</span> property, and append it to the DOM tree, so that the browser will download the specified <span

        class="courier">script</span> for you. For example:&nbsp; <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>var script = document.createElement('script');</strong></span><span><strong><br>
          </strong></span><span><strong>script.type = 'text/javascript';</strong></span><span><strong><br>
          </strong></span><span><strong>script.src = 'some.js';</strong></span><span><strong><br>
          </strong></span><span><strong>document.getElementsByTagName('head')[0].appendChild(script);</strong></span></div>
      <br>
      The above code has the same effect as writing the follow markup in the <span

        class="courier">head</span> section in the page: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>&lt;script type="text/javascript" src="some.js"&gt;&lt;/script&gt;</strong></span></div>
      <br>
      That's to say, browsers will execute the downloaded some.js. This is also a workable way to load JavaScript dynamically, and the basis of JSONP.<br>
      <br>
      As we've seen in <a href="Security.html">Security</a>, JavaScript doesn't allow getting data from different origin. Asynchronous objects also need to comply with the same origin policy. It's common, however, to request data from a server in a different domain. If there's no way to do this, many sites can't provide their cross-site services. <br>
      <br>
      The way to against this odd is using the way we've seen previously about downloading script dynamically. For example, if the current page has defined the following function:<br>
      <div class="courier" style="margin-left: 40px;"><span><strong>function doSomething(json) {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; ...</strong></span><span><strong><br>
          </strong></span><span><strong>}</strong></span></div>
      <br>
      If you download script dynamically as mentioned previously, and the downloaded code includes the following: <br>
      <div style="margin-left: 40px;"><strong><span class="courier">doSomething({"name":"Justin","age":35});</span></strong><strong></strong></div>
      <br>
      Then, browsers will use <span class="courier">{"name": "Justin", "age": 35}</span> - an object literal - to call the <span

        class="courier">doSomething</span> function. This is the basis of JSONP. JSONP stands for "JSON with padding". That is, JSON data with a prefix padding. The padding is typically the name of a callback function. <br>
      <br>
      If the server's acceptable request parameters are as follows:<br>
      <div class="courier" style="margin-left: 40px;"><strong><span class="courier">id=E123456&amp;</span><span

            class="bold_red">jsoncallback=handler</span></strong><span><br>
        </span></div>
      <br>
      The padding - the name of the callback function - is decided by a request parameter. If the request parameter is <span

        class="courier">jsoncallback=handler</span>, the server returns the following:<br>
      <div class="courier" style="margin-left: 40px;"><span><strong>handler({"name":"Justin","age":35});</strong></span></div>
      <br>
      Then, the client has more flexibility to decide which callback function is used to process the returned JSON. The following is a realistic example. You can open this page in the localhost and type an id to retrieve data. <br>
      <ul>
        <li><a href="samples/JSONP-1.html">JSONP-1.html</a></li>
      </ul>
      <pre class="prettyprint"><code lang="javascript">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta content="text/html; charset=UTF-8" http-equiv="content-type"&gt;
        &lt;script type="text/javascript" src="js/json2.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript"&gt;
            window.onload = function() {
                function param(obj) {
                    var pairs = [];
                    for(var name in obj) {
                        var pair = encodeURIComponent(name) + '=' + 
                                   encodeURIComponent(obj[name]);
                        pairs.push(pair.replace('/%20/g', '+'));
                    }
                    return pairs.join('&amp;');
                }
                
                function getScript(url, callback) {
                    var script = document.createElement('script');
                    script.type = 'text/javascript';
                    script.src = url;
                    
                    // Cross-browser processing events when download script is completed
                    script.onload = script.onreadystatechange = function() {
                        if (!this.readyState ||
                            this.readyState === "loaded" || 
                            this.readyState === "complete") {
                            this.onload = this.onreadystatechange = null;
                            document.getElementsByTagName('head')[0]
                                    .removeChild(this);
                            callback();
                        }
                    };
                    
                    document.getElementsByTagName('head')[0]
                            .appendChild(script);
                }
                
                function jsonp(option, callbackName) {
                    if(!option.url || !callbackName) {
                        return;
                    }
                    var data = option.data || {};
                    
                    // create a temporary function
                    data[callbackName] = 'XD' + jsonp.jsc++;
                    window[data[callbackName]] = function(json) {
                        option.callback(json);
                    };
                    var url = option.url + '?' + param(data);
                    
                    // download the script
                    getScript(url, function() {
                         // remove the temporary function 
                         // when the script is downloaded and executed
                         window[data[callbackName]] = undefined;
                         try {
                             delete window[data[callbackName]];
                         }
                         catch(e) {}
                    });
                }
                jsonp.jsc = new Date().getTime();
                
                document.getElementById('test').onclick = function() {
                    jsonp({
                        url      : 'https://openhome.cc/eGossip/' +
                                   'JavaScript/samples/JSONP-1.php',
                        data     : {
                            id   : document.getElementById('id').value,
                        },
                        callback : function(person) {
                            document.getElementById('result').innerHTML = 
                                person.name + ',' + person.age;
                        }
                    }, 'jsoncallback');
                };
            };
        &lt;/script&gt;        
    &lt;/head&gt;
    &lt;body&gt;
        ID：&lt;input id="id"&gt;
        &lt;button id="test"&gt;Test JSONP&lt;/button&gt;
        &lt;span id="result"&gt;&lt;/span&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
      <br>
      The URL <a href="http://api.flickr.com/services/feeds/photos_public.gne">http://api.flickr.com/services/feeds/photos_public.gne</a> provides a service through JSONP. You can use the <span

        class="courier">jsoncallback</span> parameter to specify a callback function. The following example uses a tag to search images on Filick, and display them in the page.<br>
      <ul>
        <li><a href="samples/JSONP-2.html">JSONP-2.html</a></li>
      </ul>
      <pre class="prettyprint"><code lang="javascript">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta content="text/html; charset=UTF-8" http-equiv="content-type"&gt;
        &lt;script type="text/javascript" src="js/json2.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript"&gt;
            window.onload = function() {
                function param(obj) {
                    var pairs = [];
                    for(var name in obj) {
                        var pair = encodeURIComponent(name) + '=' + 
                                   encodeURIComponent(obj[name]);
                        pairs.push(pair.replace('/%20/g', '+'));
                    }
                    return pairs.join('&amp;');
                }
                
                function getScript(url, callback) {
                    var script = document.createElement('script');
                    script.type = 'text/javascript';
                    script.src = url;
                    
                    script.onload = script.onreadystatechange = function() {
                        if (!this.readyState ||
                            this.readyState === "loaded" || 
                            this.readyState === "complete") {
                            this.onload = this.onreadystatechange = null;
                            document.getElementsByTagName('head')[0]
                                    .removeChild(this);
                            callback();
                        }
                    };
                    
                    document.getElementsByTagName('head')[0]
                            .appendChild(script);
                }
                
                function jsonp(option, callbackName) {
                    if(!option.url || !callbackName) {
                        return;
                    }
                    var data = option.data || {};
                    
                    data[callbackName] = 'XD' + jsonp.jsc++;
                    window[data[callbackName]] = function(json) {
                        option.callback(json);
                    };
                    var url = option.url + '?' + param(data);
                    
                    getScript(url, function() {
                         window[data[callbackName]] = undefined;
                         try {
                             delete window[data[callbackName]];
                         }
                         catch(e) {}
                    });
                }
                jsonp.jsc = new Date().getTime();
                
                document.getElementById('search').onclick = function() {
                    jsonp({
                        url      : 'http://api.flickr.com/services/' + 
                                   'feeds/photos_public.gne',
                        data     : {
                            tagmode : 'any',
                            format  : 'json',
                            tags    : document.getElementById('tags').value
                        },
                        callback : function(data) {
                            var images = document.getElementById('images');
                            // empty all images
                            var length = images.childNodes.length;
                            for(var i = 0; i &lt; length; i++) {
                                images.removeChild(images.firstChild);
                            }
                            // Flick retusn JSNOP. You can observe its data format.
                            // items is an array. Every element has a media property.
                            // the m property of media is the image's url.
                            var items = data.items;
                            for(var i = 0; i &lt; items.length; i++) {
                                var img = document.createElement('img');
                                img.src = items[i].media.m;
                                images.appendChild(img);
                            }
                        }
                    }, 'jsoncallback');
                };
            };
        &lt;/script&gt;        
    &lt;/head&gt;
    &lt;body&gt;
    	&lt;input id="tags"&gt;&lt;br&gt;
		&lt;button id="search"&gt;Search&lt;/button&gt;
    	&lt;div id="images"&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
      <br>
<div class="recommend" style="text-align: center;"><hr><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
    
        </article></main></div></body>
<script src="http://openhome.cc/Gossip/js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
