<!DOCTYPE html>
<html lang="zh-tw">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="線段？這主題有點怪？無論是畫 Turtle Spiral Generator，或者是 Symmetrical triangle generator，都需要線段：

可惜的是，OpenSCAD 的內建...">
    <meta property="og:locale" content="zh_TW">
    <meta property="og:title" content="線段">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://openhome.cc/Gossip/OpenSCAD/Polyline.html">
    <meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
    <meta property="og:site_name" content="OPENHOME.CC">
    <meta property="og:description" content="線段？這主題有點怪？無論是畫 Turtle Spiral Generator，或者是 Symmetrical triangle generator，都需要線段：

可惜的是，OpenSCAD 的內建...">
    <title>線段</title>
    <link rel="stylesheet" href="http://openhome.cc/Gossip/css/pure-0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="http://openhome.cc/Gossip/css/layouts/side-menu.css">
    <!--<![endif]-->
    <link rel="stylesheet" href="http://openhome.cc/Gossip/css/caterpillar.css">
    <script async="" src="http://openhome.cc/Gossip/google-code-prettify/run_prettify.js"></script>
  <!-- 網頁層級廣告 --><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
  <body>
    <div id="layout">
      <!-- Menu toggle --> <a href="Polyline.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon --> <span></span> </a>
      <div id="menu">
        <div class="pure-menu"> <a class="pure-menu-heading" href="index.html">回
            OpenSCAD 目錄</a>
          <ul class="pure-menu-list">
            <li class="pure-menu-item"><br>
              <div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img
                    title="Twitter" alt="Twitter" src="../images/twitter.png"></a>
                <a href="http://www.facebook.com/openhome.cc"><img title="Facebook"
                    alt="Facebook" src="../images/facebook.png"></a>
                </div>
              <br>
              <div id="search box">
                <script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div>
              <br>
              <div class="ad" style="text-align: center;">
                <script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- 2015 新版型 160 x 600 廣告 -->
                <ins class="adsbygoogle" style="display:inline-block;width:160px;height:600px"
                  data-ad-client="ca-pub-9750319131714390" data-ad-slot="3747048883"></ins>
                <script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
          </ul>
        </div>
      </div>
      <main id="main">
        <header class="header">
          <h1>線段</h1>
        </header>
        <article class="content"> <br>
          <div class="ad-3" style="text-align: center;">
            <script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins
              class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390"
              data-ad-slot="7104125683" data-ad-format="auto"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
          <p>線段？這主題有點怪？無論是畫 <a href="https://www.thingiverse.com/thing:1207095">Turtle
              Spiral Generator</a>，或者是 <a href="https://www.thingiverse.com/thing:1213278">Symmetrical
              triangle generator</a>，都需要線段：</p>
          <p><a href="https://www.thingiverse.com/thing:1207095"></a></p>
          <div class="pure-g">
            <div class="pure-u-1"><a href="https://www.thingiverse.com/thing:1207095"><img
                  class="pure-img-responsive" src="http://thingiverse-production-new.s3.amazonaws.com/renders/d7/6b/27/a1/60/turtle_spiral_preview_featured.JPG"
                  alt="Turtle Spiral Generator"></a></div>
          </div>
          <p></p>
          <p><a href="https://www.thingiverse.com/thing:1213278"></a></p>
          <div class="pure-g">
            <div class="pure-u-1"><a href="https://www.thingiverse.com/thing:1213278"><img
                  class="pure-img-responsive" src="http://thingiverse-production-new.s3.amazonaws.com/renders/d4/d4/99/d9/e2/symmetrical_virtual_triangle_preview_featured.JPG"
                  alt="Symmetrical triangle generator"></a></div>
          </div>
          <p></p>
          <p>可惜的是，OpenSCAD 的內建模組中，並沒有 <code>polyline</code> 這樣的模組，怎麼辦呢？</p>
          <h1>polygon</h1>
          <p>在 OpenSCAD 中有個 <code>polygon</code>
            模組，可以用來建立多邊型，最簡單的使用方式就如同官方文件上寫的，只要給定每個頂點，就會自動建立多邊型，也可以指定路徑索引順序，以下幾個都會建立相同的多邊型：</p>
          <pre class="prettyprint"><code lang="openscad">polygon(points=[[0,0],[100,0],[130,50],[30,50]]);
polygon([[0,0],[100,0],[130,50],[30,50]], paths=[[0,1,2,3]]);
polygon([[0,0],[100,0],[130,50],[30,50]],[[3,2,1,0]]);
polygon([[0,0],[100,0],[130,50],[30,50]],[[1,0,3,2]]);
</code></pre>
          <p>建立出來的圖片，就直接取自官方圖片吧！</p>
          <p></p>
          <div class="pure-g">
            <div class="pure-u-1"><img class="pure-img-responsive" src="https://upload.wikimedia.org/wikipedia/commons/d/df/OpenSCAD_Polygon_Example_Rhomboid.jpg"
                alt="polygon"></div>
          </div>
          <p></p>
          <h1>兩點決定一線</h1>
          <p>為什麼突然冒出 <code>polygon</code>
            的介紹？這是用來建立多邊型的，不是用來建立直線的模組！好吧！就將話題先拉回，如果想要有個 <code>polyline</code>
            模組，可用來指定線段的各個點，然後自動連成一條線，第一個要解決的是什麼呢？</p>
          <p>寫程式就是要大任務分解為小任務，因此至少要先能夠兩點決定一個線，第一個想法是，OpenSCAD 有 <code>square</code>
            模組，如果寬度設得細細的，就像是條線了，接著可以看看兩點之間的距離決定長度，然後算出與 x 軸的夾角，使用 <code>rotate</code>
            旋轉，最後將建立的細長方形移至正確的位置…</p>
          <p>想到這邊，就覺得這個方法有點麻煩了，因此第二個想法就是，既然 OpenSCAD 有個 <code>polygon</code>
            模組，只要指定頂點就可以畫多邊形，那麼能不能只指定兩個點，另兩個點根據線的寬度來計算，就可以畫出一條直線了？根據這個想法，暫且實作出以下的程式：</p>
          <pre class="prettyprint"><code lang="openscad">module line(p1, p2, width) {
    polygon([
        p1, p2, [p2[0], p2[1] - width], [p1[0], p1[1] - width]
    ]);
}

line([1, 2], [-5, -4], 1);
</code></pre>
          <p>實作出來的效果還不錯：</p>
          <p></p>
          <div class="pure-g">
            <div class="pure-u-1"><img class="pure-img-responsive" src="images/Polyline-1.JPG"
                alt="線段"></div>
          </div>
          <p></p>
          <p>這邊只是簡單地將兩個點的 y
            座標下移一個線寬，然而，如果你龜毛一點，馬上就會想到，這不是我們要的線寬，線寬應該是上下兩個平行線之間的距離，而不是垂直方向的距離。</p>
          <p>既然要龜毛，就龜毛個徹底一些好了，我們想要有這樣的效果：</p>
          <p></p>
          <div class="pure-g">
            <div class="pure-u-1"><img class="pure-img-responsive" src="images/Polyline-2.JPG"
                alt="線段"></div>
          </div>
          <p></p>
          <p>也就是，畫出來線佔的寬度，會是在兩點之間各佔一半，而根據上圖列出的關係，可以使用三角函式反推 <code>angle</code>：</p>
          <pre class="prettyprint"><code lang="openscad">angle = atan((p2[1] - p1[1]) / (p2[0] - p1[0]));
</code></pre>
          <p>因此，<code>polygon</code> 模組需要的四個點就是：</p>
          <pre class="prettyprint"><code lang="openscad">offset_x = 0.5 * width * cos(90 - angle);
offset_y = 0.5 * width * sin(90 - angle);
offset1 = [-offset_x, offset_y];
offset2 = [offset_x, -offset_y];
points=[
    point1 + offset1, point2 + offset1,  
    point2 + offset2, point1 + offset2
];
</code></pre>
          <p>將上面的公式整理一下，實作為 <code>line</code> 模組的話：</p>
          <pre class="prettyprint"><code lang="openscad">module line(point1, point2, width = 1) {
    angle = 90 - atan((point2[1] - point1[1]) / (point2[0] - point1[0]));
    offset_x = 0.5 * width * cos(angle);
    offset_y = 0.5 * width * sin(angle);

    offset1 = [-offset_x, offset_y];
    offset2 = [offset_x, -offset_y];

    polygon(points=[
        point1 + offset1, point2 + offset1,  
        point2 + offset2, point1 + offset2
    ]);
}

line([1, 2], [-5, -4], 1);
</code></pre>
          <p>出來的效果如下：</p>
          <p></p>
          <div class="pure-g">
            <div class="pure-u-1"><img class="pure-img-responsive" src="images/Polyline-3.JPG"
                alt="線段"></div>
          </div>
          <p></p>
          <h1>polyline</h1>
          <p>有了 <code>line</code> 模組可以兩點間畫一條線，接下來就可以實作 <code>polyline</code>
            模組了，只要兩個點為一組，將全部的點消耗完就可以了：</p>
          <pre class="prettyprint"><code lang="openscad">module line(point1, point2, width = 1) {
    angle = 90 - atan((point2[1] - point1[1]) / (point2[0] - point1[0]));
    offset_x = 0.5 * width * cos(angle);
    offset_y = 0.5 * width * sin(angle);

    offset1 = [-offset_x, offset_y];
    offset2 = [offset_x, -offset_y];

    polygon(points=[
        point1 + offset1, point2 + offset1,  
        point2 + offset2, point1 + offset2
    ]);
}

module polyline(points, width = 1) {
    module polyline_inner(points, index) {
        if(index &lt; len(points)) {
            line(points[index - 1], points[index], width);
            polyline_inner(points, index + 1);
        }
    }

    polyline_inner(points, 1);
}

polyline([[1, 2], [-5, -4], [-5, 3], [5, 5]], 1);
</code></pre>
          <p>畫出來的效果是：</p>
          <p></p>
          <div class="pure-g">
            <div class="pure-u-1"><img class="pure-img-responsive" src="images/Polyline-4.JPG"
                alt="線段"></div>
          </div>
          <p></p>
          <p>咦？怎麼缺角了？因為基本上，<code>line</code>
            模組實作出來是個長方形嘛！解決缺角的一個方式是，在兩點構成的線兩端加上個小圓：</p>
          <pre class="prettyprint"><code lang="openscad">module line(point1, point2, width = 1, cap_round = true) {
    angle = 90 - atan((point2[1] - point1[1]) / (point2[0] - point1[0]));
    offset_x = 0.5 * width * cos(angle);
    offset_y = 0.5 * width * sin(angle);

    offset1 = [-offset_x, offset_y];
    offset2 = [offset_x, -offset_y];

    if(cap_round) {
        translate(point1) circle(d = width, $fn = 24);
        translate(point2) circle(d = width, $fn = 24);
    }

    polygon(points=[
        point1 + offset1, point2 + offset1,  
        point2 + offset2, point1 + offset2
    ]);
}

module polyline(points, width = 1) {
    module polyline_inner(points, index) {
        if(index &lt; len(points)) {
            line(points[index - 1], points[index], width);
            polyline_inner(points, index + 1);
        }
    }

    polyline_inner(points, 1);
}

polyline([[1, 2], [-5, -4], [-5, 3], [5, 5]], 1);
</code></pre>
          <p>完成的效果如下：</p>
          <p></p>
          <div class="pure-g">
            <div class="pure-u-1"><img class="pure-img-responsive" src="images/Polyline-5.JPG"
                alt="線段"></div>
          </div>
          <p></p>
          <p>效果感覺還不錯呢！實際上，這只是畫線一種實現方式，根據需求的不同，還可以有其他的實作方式，舉個例子來說，<a href="https://www.thingiverse.com/thing:1782226">Archimedean
              spiral generator</a>
            就使用了另外一種線段的實作方式，這可以改天再來談，你也可以試著動腦想想看，這也是使用程式建模的樂趣之一喔！</p>
          <br>
          <br>
          <div class="ad336-280" style="text-align: center;">
            <script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins
              class="adsbygoogle" style="display:inline-block;width:336px;height:280px"
              data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
          <br>
          <div class="recommend" style="text-align: center;">
            <hr>
            <script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins
              class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390"
              data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article>
      </main>
    </div></body>
    <script src="http://openhome.cc/Gossip/js/ui.js"></script>
    <div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
  
</html>
