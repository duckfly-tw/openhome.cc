<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="C++ 標準函式庫提供 string，可以使用這個類別來建立字串，便於進行高階的字串操作，像是字串指定、串接等，若要表現字串，C++ 建議使用 string，這要先包含 string 標頭檔：
#in...">

    <meta property="og:locale" content="zh_TW">
    <meta property="og:title" content="使用 string">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://openhome.cc/Gossip/CppGossip/string2.html">
    <meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
    <meta property="og:site_name" content="OPENHOME.CC">
    <meta property="og:description" content="C++ 標準函式庫提供 string，可以使用這個類別來建立字串，便於進行高階的字串操作，像是字串指定、串接等，若要表現字串，C++ 建議使用 string，這要先包含 string 標頭檔：
#in...">

    <title>使用 string</title>

    <link rel="stylesheet" href="http://openhome.cc/Gossip/css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="http://openhome.cc/Gossip/css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="http://openhome.cc/Gossip/css/caterpillar.css">
     <script async src="http://openhome.cc/Gossip/google-code-prettify/run_prettify.js"></script>
     <!-- 網頁層級廣告 --><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="string2.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="http://openhome.cc/Gossip/CppGossip/">回 C++ 目錄</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a></div><br> <div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>使用 string</h1>
        </header>

        <article class="content">
            <br><div class="ad-3" style="text-align: center;"><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
            <p>C++ 標準函式庫提供 <a href="https://en.cppreference.com/w/cpp/string"><code>string</code></a>，可以使用這個類別來建立字串，便於進行高階的字串操作，像是字串指定、串接等，若要表現字串，C++ 建議使用 <code>string</code>，這要先包含 <code>string</code> 標頭檔：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;string&gt;
</code></pre>
<p>可以使用以下方式來建立 <code>string</code> 實例，例如：</p>
<pre class="prettyprint"><code lang="c++">string str1;                 // 內容為空字串
string str2("caterpillar");  // 內容為指定的字串常量
string str3(str2);           // 以 str1 實例建立字串
string str4 = "Justin";      // 內容為指定的字串常量
</code></pre>
<p>第一個方式建立了空字串，長度為 0；第二個方式會以字面常量內容來建立 <code>string</code> 實例；第三個方法會複製  <code>str2</code>，並建立一個新的 <code>string</code> 實例，第四個方式也是以字面常量內容來建立 <code>string</code> 實例。</p>
<p>可以使用 <code>size()</code> 或 <code>length()</code> 來取得字串長度，使用 <code>empty()</code> 測試字串是否為空，使用 <code>==</code> 比較兩個字串的內容是否相同，例如：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;iostream&gt; 
#include &lt;string&gt; 
using namespace std; 

int main() { 
    string str1; 
    string str2 = "caterpillar"; 
    string str3(str2); 

    cout &lt;&lt; "str1 是否為空：" &lt;&lt; str1.empty() &lt;&lt; endl;
    cout &lt;&lt; "str1 長度: " &lt;&lt; str1.size() &lt;&lt; endl;
    cout &lt;&lt; "str2 長度: " &lt;&lt; str2.size() &lt;&lt; endl;
    cout &lt;&lt; "str3 長度: " &lt;&lt; str3.size() &lt;&lt; endl;

    cout &lt;&lt; "str1 與 str2 內容是否相同：" &lt;&lt; (str1 == str2) &lt;&lt; endl;
    cout &lt;&lt; "str2 與 str3 內容是否相同：" &lt;&lt; (str3 == str3) &lt;&lt; endl;

    return 0; 
}
</code></pre>
<p>執行結果：</p>
<pre class="prettyprint"><code lang="c++">str1 是否為空：1
str1 長度: 0
str2 長度: 11
str3 長度: 11
str1 與 str2 內容是否相同：0
str2 與 str3 內容是否相同：1
</code></pre>
<p>可以將字串指定給另一個字串，例如：</p>
<pre class="prettyprint"><code lang="c++">string str1 = "text1";
string str2 = "text2";
....
str1 = str2;
</code></pre>
<p>以上指定會將 <code>str1</code> 原本的字串記憶體空間釋放，並重新配置足夠容納 <code>str2</code> 的記憶體空間，然後將 <code>str2</code> 的內容逐一複製至 <code>str1</code>；也可以將一個 C 風格的字串指定給 <code>string</code>，例如：</p>
<pre class="prettyprint"><code lang="c++">string name = "caterpillar";
char str[] = "Justin";
name = str;
</code></pre>
<p>然而不能將一個 <code>string</code> 實例指定給字元陣列，例如：</p>
<pre class="prettyprint"><code lang="c++">char str[] = "Justin";
string name = "caterpillar";
str = name; // error
</code></pre>
<p>可以使用 <code>+</code> 運算子來串接字串，例如：</p>
<pre class="prettyprint"><code lang="c++">str1 = str1 + str2;
str1 = str1 + "\n";
</code></pre>
<p><code>string</code> 實例可以使用 <code>[]</code> 指定索引來存取相對應位置的 <code>char</code>，就有如字元陣列的操作一般，例如：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;iostream&gt; 
#include &lt;string&gt; 
using namespace std; 

int main() { 
    string name = "caterpillar";

    for(int i = 0; i &lt; name.length(); i++) {
        cout &lt;&lt; name[i] &lt;&lt; endl;
    }

    return 0; 
}
</code></pre>
<p>對於循序走訪的需求，可以使用 for range 語法：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;iostream&gt; 
#include &lt;string&gt; 
using namespace std; 

int main() { 
    string name = "caterpillar";

    for(auto ch : name) {
        cout &lt;&lt; ch &lt;&lt; endl;
    }

    return 0; 
}
</code></pre>
<p>那麼是該面對問題的時候了，對於 <code>"caterpillar"</code>，以上範例是會逐一顯示各個字母沒錯，若是中文呢？這就要回憶一下〈<a href="string1.html">字元陣列與字串</a>〉的內容了，例如以上會顯示什麼呢？</p>
<pre class="prettyprint"><code lang="c++">string name = "良葛格";
cout &lt;&lt; name.length() &lt;&lt; endl;
</code></pre>
<p>類似地，這要看你的原始碼編碼是什麼，以及編譯時下的參數是什麼，如果是這個的話：</p>
<pre class="prettyprint"><code lang="c++">string name = u8"良葛格";
cout &lt;&lt; name.length() &lt;&lt; endl;
</code></pre>
<p>就是顯示 9 了，因為一個中文字以 UTF-8 編碼的話，會有三個位元組，也就是說，對於 C++ 來說，這是個多位元組字元組成的字串，每個中文要使用三個 <code>char</code>，若要正確顯示中文的話，你的文字模式要是 UTF-8，然後如下撰寫程式：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;iostream&gt; 
#include &lt;string&gt; 
using namespace std; 

int main() { 
    string name = u8"良葛格";
    for(int i = 0; i &lt; name.length(); i += 3) {
        cout &lt;&lt; name.substr(i, 3) &lt;&lt; endl;
    }

    return 0; 
}
</code></pre>
<p><code>string</code> 的 <code>substr</code> 方法可以指定索引與 <code>char</code> 長度來取得子字串，因為是 UTF-8 編碼，每次要取三個 <code>char</code>，然後索引加 3。</p>
<p>這當然是蠻麻煩的一件事，而且 UTF-8 編碼的字串中若有中英、數字夾雜的話就很麻煩了，〈<a href="string1.html">字元陣列與字串</a>〉中談過 <code>wchar_t</code>、<code>char16_t</code>、<code>char32_t</code> 與 <code>char8_t</code>，<code>string</code> 標頭中對應的版本是 <code>wstring</code>、<code>u16string</code>、<code>u32string</code> 與 <code>u8string</code>。</p>
<p>因此，若直接搭配〈<a href="string1.html">字元陣列與字串</a>〉中的 <code>toUTF8</code> 函式，可以直接使用 <code>cout</code> 來顯示中文，以 <code>wstring</code> 為例的話：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;iostream&gt;
#include &lt;string&gt;

using namespace std;
string toUTF8(int cp);

int main(int argc, char *argv[]) {
    // 在 UTF-8 終端機下會顯示正確中文
    wstring name = L"良葛格（Justin）";
    for(int i = 0; i &lt; name.length(); i++) {
        cout &lt;&lt;  toUTF8(name[i]) &lt;&lt; endl;
    }

    return 0;
}

string toUTF8(int cp) {
    char ch[5] = {0x00};
    if(cp &lt;= 0x7F) { 
        ch[0] = cp; 
    }
    else if(cp &lt;= 0x7FF) { 
        ch[0] = (cp &gt;&gt; 6) + 192; 
        ch[1] = (cp &amp; 63) + 128; 
    }
    else if(0xd800 &lt;= cp &amp;&amp; cp &lt;= 0xdfff) {} // 無效區塊
    else if(cp &lt;= 0xFFFF) { 
        ch[0] = (cp &gt;&gt; 12) + 224; 
        ch[1]= ((cp &gt;&gt; 6) &amp; 63) + 128; 
        ch[2]= (cp &amp; 63) + 128; 
    }
    else if(cp &lt;= 0x10FFFF) { 
        ch[0] = (cp &gt;&gt; 18) + 240; 
        ch[1] = ((cp &gt;&gt; 12) &amp; 63) + 128; 
        ch[2] = ((cp &gt;&gt; 6) &amp; 63) + 128; 
        ch[3]= (cp &amp; 63) + 128; 
    }
    return string(ch);
}
</code></pre>
<p>C++ 11 提供了 <a href="https://en.cppreference.com/w/cpp/locale/wstring_convert"><code>wstring_convert</code></a>，便於在 <code>string</code> 與 <code>wstring</code> 間轉換，例如，若要將 <code>wstring</code> 轉換為 UTF-8 編碼的 <code>string</code>，可以如下：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;locale&gt;
#include &lt;codecvt&gt;
#include &lt;string&gt;
#include &lt;iostream&gt;
using namespace std;

int main() {
    wstring_convert&lt;codecvt_utf8&lt;wchar_t&gt;&gt; utf8;
    wstring ws = L"良葛格";
    string s = utf8.to_bytes(ws);
    cout &lt;&lt; s &lt;&lt; endl; // 在 UTF-8 編碼終端機下可顯示中文
}
</code></pre>
<p>若只是要在標準輸出中顯示 <code>wstring</code>，可以使用 <code>wcout</code>，不過必須設定正確的 <code>locale</code>，才能顯示正確的字元，在許多文件中都會寫到可以這麼使用：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;iostream&gt;
#include &lt;locale&gt;
using namespace std;

int main( void ) {
    locale loc("cht");
    wcout.imbue(loc);

    wcout &lt;&lt; L"良葛格" &lt;&lt; endl;

    return 0;
}
</code></pre>
<p>不過我使用 <a href="https://sourceforge.net/projects/mingw-w64/files/mingw-w64/mingw-w64-release/">MinGW-w64</a>，GNU 編譯器版本 8.1.0 編譯後，執行時會發生底下的問題：</p>
<pre class="prettyprint"><code lang="c++">terminate called after throwing an instance of 'std::runtime_error'
  what():  locale::facet::_S_create_c_locale name not valid
</code></pre>
<p>這似乎是 Windows 上 MinGW-w64 的問題，我找到以下的方式解決：</p>
<pre class="prettyprint"><code lang="c++">#include &lt;iostream&gt;
#include &lt;locale&gt;
#include &lt;string&gt;
#include &lt;codecvt&gt;
using namespace std;

int main() {
    ios_base::sync_with_stdio(false);
    locale utf8(std::locale(), new codecvt_utf8&lt;wchar_t&gt;);
    wcout.imbue(utf8);

    wcout &lt;&lt; L"良葛格" &lt;&lt; endl; // 在 UTF-8 編碼終端機下可顯示中文

    return 0;
}
</code></pre>

            
           <br><br><div class="ad336-280" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article>
    </main>
</div></body>
</html>
<script src="http://openhome.cc/Gossip/js/ui.js"></script>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
