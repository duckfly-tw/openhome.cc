<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Java Tutorial 第三堂（3）使用 Servlet、JSP 開發 Web 應用程式&nbsp;&lt;&lt; 前情
      
      
      你可以在 Google P...">

<meta property="og:locale" content="zh_TW">
<meta property="og:title" content="Java Tutorial 第四堂（1）使用 spring-webmvc 框架">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/Gossip/CodeData/JavaTutorial/SpringWebMVC.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="Java Tutorial 第三堂（3）使用 Servlet、JSP 開發 Web 應用程式&nbsp;&lt;&lt; 前情
      
      
      你可以在 Google P...">


    <title>Java Tutorial 第四堂（1）使用 spring-webmvc 框架</title>

<link rel="stylesheet" href="../../css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="../../css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="../../css/caterpillar.css">
     <script async src="../../google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="SpringWebMVC.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon --><span></span>
        
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">回 Java Tutorial</a>
            <ul class="pure-menu-list">
                <br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../../images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>Java Tutorial 第四堂（1）使用 spring-webmvc 框架</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
      <br>
      <br>
      你可以在 <a href="https://play.google.com/store/books/details?id=LaJbAwAAQBAJ">Google Play</a> 或 <a

        href="http://www.pubu.com.tw/ebook/Java-Tutorial-Learn-Java-in-06-00-00-30862">Pubu</a> 購買 Java Tutorial 系列文章的電子書。
      <br>
      <br>
      Servlet、JSP 是 Java 世界 Web 方案的底層技術，只是要直接用&nbsp;Servlet、JSP 來建立中大型 Web 應用程式需要比較多的手續，基於快速開發、團隊規範、第三方整合等因素，你可能會選擇使用 Web 框架（Framework），<strong><span

          style="color: #ff0000;">至於什麼是框架？它跟程式庫（Library）有何不同？</span></strong>
      <br>
      <br>
      在&nbsp;<a href="../PythonTutorial/Django.html">Python Tutorial 第四堂（1）Django 起步走</a> 中，介紹過框架與程式庫的不同，以下引用一些內容來進行說明：
      <h1>程式庫 vs 框架</h1>
      從課程一開始，你就一直在使用程式庫，你的程式流程一直在你的控制之內，<strong>你決定</strong>了程式何時要使用程式庫來詢問使用者問題、何時要讀取使用者回應、何時要處理結果 …
      <br>
      <br>
      當你開始使用框架，你會發現不是你決定程式流程，你會定義函式，由框架決定何時來呼叫你定義的函式。<span style="color: #ff0000;"><strong>流程的控制權被反轉了，現在是框架在定義流程，在既定的流程中框架會呼叫你的函式，而不是你來呼叫框架</strong></span>。
      <h1>IoC（Inversion of Control）</h1>
      在談到框架時，經常會聽到<span style="color: #ff0000;"><strong> IoC</strong> </span>這個縮寫名稱，也就是<strong><span

          style="color: #ff0000;"> Inversion of Control</span></strong>，既<strong><span

          style="color: #ff0000;">控制權反轉</span></strong>，<span style="color: #ff0000;"><strong>什麼控制權被反轉了？誰能決定程式的流程！</strong></span>
      <br>
      <br>
      使用程式庫的話，流程的控制是這樣的 ...<br>
      <br>
      &nbsp;<a href="images/python-tutorial-the-4th-class-2.png"><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" class="alignnone size-full wp-image-3994"

          alt="python-tutorial-the-4th-class-2" src="images/python-tutorial-the-4th-class-2.png"

          height="196" width="648" /></div></div></a>
      &nbsp;
      <br>
      <br>
      藍色部份是你可以自行掌控的部份，你決定程式流程走向，並在過程中必要時機，引用各種程式庫！
      使用框架的話，流程的控制是這樣的 …
      <br>
      <br>
      <a href="images/python-tutorial-the-4th-class-3.png"><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" class="alignnone size-full wp-image-3995"

          alt="python-tutorial-the-4th-class-3" src="images/python-tutorial-the-4th-class-3.png"

          height="228" width="689" /></div></div></a>
      <br>
      <br>
      藍色部份是你可以自行掌控的部份，也就是框架規範下可進行的元件實作，框架在本身定義的流程下適當時機，會呼叫你的元件實作。
      <h1>我們需要使用框架嗎？</h1>
      應用程式開發時是否需要使用框架，有很多考量點 … 然而簡單來說 ...&nbsp;<strong><span style="color: #ff0000;">使用程式庫時，開發者會擁有較高的自由度；使用框架時，開發者會受到較大的限制。</span></strong>
      <br>
      <br>
      限制？有哪些限制？很多 … 是否需要使用框架？是否要遵循框架規範的流程？使用框架是基於技術考量？還是基於商業上的考量？（嗯 ... 因為這框架是採購案中被綁在一起的 ... 上頭叫我們要用我們就得用？）... 這幾個問題都是必須想想看的 ...
      <br>
      <br>
      股市有句名言，好的老師帶你上天堂，不好的老師帶你住套房。用框架時可以這麼想 … <strong>好的框架帶你上天堂，不好的框架讓你下地獄</strong> ... XD
      <h1>使用 spring-webmvc 框架</h1>
      在 Java 的世界中，最不缺少的就是框架，這是 Java 的優點也是缺點，畢竟選擇眾多與太多只是一線之隔。如果你願意，想要使用風格如 Ruby 界的 <a

        href="http://rubyonrails.org/">Rails</a>、Python 界的 <a href="https://www.djangoproject.com/">Django</a> 等的快速開發框架，在 Java 的世界中也有 <a

        href="http://www.playframework.com/">Play</a> 這類框架的存在。
      <br>
      <br>
      在這門課程中，選擇使用 spring-webmvc 框架，這是 <a href="http://projects.spring.io/spring-framework/">Spring 框架</a> 的一部份，選擇使用它的原因，是它在 Java 界算是知名度與歡迎度都很高的框架，而且第三方程式庫及框架的整合度高，這篇會先練習使用 spring-webmvc 改寫 <a

        href="ServletJSP.html">Java Tutorial 第三堂（3）使用 Servlet、JSP 開發 Web 應用程式</a>&nbsp;中的練習 10，後續會持續再基於 spring-webmvc 整合更多的方案。
      <span style="color: #ff0000;"><strong><br>
          <br>
          練習 11：使用 spring-webmvc</strong></span>
      <br>
      <br>
      在 Lab 檔案的 exercises/exercise11 中有個 SpringMVC 的專案，這其實是練習 10 的成果，只不過目錄名稱改為 SpringMVC 了，請開啟其中的 build.gradle，在&nbsp;<code>dependencies { ... }</code> 中加入 <code>compile 'org.springframework:spring-webmvc:4.0.0.RELEASE'</code>：
      <pre class="prettyprint"><code lang="java">dependencies {
    compile 'org.springframework:spring-webmvc:4.0.0.RELEASE'
    ...
}</code></pre>
      <br>
      在 src/main/webapp 中建立 <strong>WEB-INF</strong> 目錄，接著在 WEB-INF 中建立 <strong>web.xml</strong> 檔案如下：
      <pre class="prettyprint"><code lang="java">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
         http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</code></pre>
      <br>
      這使用了 spring-webmvc 的 <code>DispatcherServlet</code> 接受請求，只要是 URL 以 <code>/</code> 結束的請求，都會交由 <code>DispatcherServlet</code> 處理，依照這邊的設定，<code>DispatcherServlet</code> 預設需要讀取 <strong>WEB-INF 中 dispatcher-servlet.xml</strong> 設定檔：
      <pre class="prettyprint"><code lang="java">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:mvc="http://www.springframework.org/schema/mvc"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:p="http://www.springframework.org/schema/p"
xmlns:context="http://www.springframework.org/schema/context"
xsi:schemaLocation="http://www.springframework.org/schema/beans <br>http://www.springframework.org/schema/beans/spring-beans-4.0.xsd <br>http://www.springframework.org/schema/mvc <br>http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd <br>http://www.springframework.org/schema/context <br>http://www.springframework.org/schema/context/spring-context-4.0.xsd"&gt;

    &lt;context:component-scan base-package="tw.codedata" /&gt;
    &lt;mvc:annotation-driven /&gt;

    &lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"
          p:prefix="/"
          p:suffix=".jsp"/&gt;
&lt;/beans&gt;</code></pre>
      <br>
      開頭的 XML 宣告有些嚇人，不過基本上只要複製貼上就可以了，<code>&lt;context:component-scan base-package="tw.codedata" /&gt;</code> 告訴 spring-webmvc，要掃描 <code>tw.codedata</code> 套件下，是否有被相關標註（Annotation）設定為元件的類別，這樣的話，你就不用寫一堆 XML 設定檔，對於快速開發會有所助益；<code>&lt;mvc:annotation-driven /&gt;</code> 則是告訴 spring-webmvc，有關於接受、處理請求的元件，也會使用標註來設定相關訊息。
      <br>
      <br>
      就這個範例來說，<code>InternalResourceViewResolver</code> 的設定不是必要的，如果沒設，處理請求的元件就必須以字串告知 spring-webmvc，接下來由哪個 URL 組織畫面進行回應，也就是你必須傳回如 <code>"hello.jsp"</code> 這樣的字串，這樣會比較沒有彈性，如上設定 <code>InternalResourceViewResolver</code> 的話，你只要傳回 <code>"hello"</code> 字串，<code>InternalResourceViewResolver</code> 會自動根據 <code>prefix</code> 與 <code>suffix</code> 設定，得知目前實際上要以 <code>"/hello.jsp"</code> 來進行畫面回應，將來若想要改為其他回應技術，就只需要修改 XML 檔案。
      <br>
      <br>
      接下來修改 src/main/java/tw/codedata 目錄中的 HelloWorld.java 如下：
      <pre class="prettyprint"><code lang="java">package tw.codedata;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

@Controller
public class HelloWorld {
    @RequestMapping("hello")
    public String hello(@RequestParam("user") String user, Model m) {
        m.addAttribute("user", user);
        return "hello";
    }
}</code></pre>
      <span style="color: #ff0000;"><strong><br>
          spring-webmvc 是個支援 MVC 流程架構的框架</strong></span>，在 MVC 中，請求是由控制器接受，spring-webmvc 的實作上，可以用 <code>@Controller</code> 標示擔任控制器的類別，至於 URL 對應，則使用 <code>@RequestMapping</code>，這邊的設定表示 "/hello" 的請求會由 <code>hello</code> 方法處理。<br>
      <br>
      如果有請求參數，方法上可使用 <code>@RequestParam</code> 標註哪個請求參數指定給哪個方法參數，<code>Model</code> 參數用來攜帶回應頁面要用到的資料，屬性名稱設定為 <code>"user"</code> 時，在 JSP 中可使用 <code>${user}</code> 來取得，方法最後傳回 <code>"hello"</code>，根據先前 <code>InternalResourceViewResolver</code> 的設定，回應的頁面將會是 <code>"/hello.jsp"</code>。
      <br>
      <br>
      完成以上相關設定與程式碼撰寫之後，接著執行 <code>gradle tomcatRunWar</code> 指令，開啟瀏覽器請求 http://localhost:8080/SpringMVC/hello?user=CodeData&nbsp;你應該要能看到以下畫面：<br>
      <br>
      &nbsp;<a href="images/java-tutorial-the-4th-class-1-1.png"><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" class="alignnone size-full wp-image-4196"

          alt="java-tutorial-the-4th-class-1-1" src="images/java-tutorial-the-4th-class-1-1.png"

          height="214" width="686" /></div></div></a>
      &nbsp;
      <br>
      <br>
      還記得&nbsp;<a href="SpringJdbc.html">Java Tutorial 第三堂（2）</a>中使用過 spring-jdbc 存取資料庫嗎？下一篇文章，將會使用 Spring 的相依注入（Dependency Injection）來進行整合。
      <br>
      <br><br><br><div class="ad336-280" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></article></main></div></body>
<script src="../../js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
