<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="開場不囉嗦！先來段彈奏卡農的影片，就知道今天要介紹的東西，能有什麼樣的效果：
YouTube
好吧！這不是烏克麗麗，因為它沒有弦，只是因為它的尺寸接近烏克麗麗，就叫它電烏克麗麗，總之名稱不重要 &he...">

<meta property="og:locale" content="zh_TW">
<meta property="og:title" content="EV3 Tutorial（9）來一把電烏克麗麗！">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/Gossip/CodeData/EV3Tutorial/EV3Tutorial9.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="開場不囉嗦！先來段彈奏卡農的影片，就知道今天要介紹的東西，能有什麼樣的效果：
YouTube
好吧！這不是烏克麗麗，因為它沒有弦，只是因為它的尺寸接近烏克麗麗，就叫它電烏克麗麗，總之名稱不重要 &he...">

    <title>EV3 Tutorial（9）來一把電烏克麗麗！</title>

<link rel="stylesheet" href="http://openhome.cc/Gossip/css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="http://openhome.cc/Gossip/css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="http://openhome.cc/Gossip/css/caterpillar.css">
     <script async src="http://openhome.cc/Gossip/google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="EV3Tutorial9.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="http://openhome.cc/Gossip/CodeData/EV3Tutorial/">回 EV3 Tutorial</a>
            <ul class="pure-menu-list">
                <br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../../images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>EV3 Tutorial（9）來一把電烏克麗麗！</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            <p>開場不囉嗦！先來段彈奏卡農的影片，就知道今天要介紹的東西，能有什麼樣的效果：</p>
<p><a href="https://www.youtube.com/watch?v=sNHLQxQ3jm8">運作影片</a></p>
<p>好吧！這不是烏克麗麗，因為它沒有弦，只是因為它的尺寸接近烏克麗麗，就叫它電烏克麗麗，總之名稱不重要 &hellip; XD</p>
<h1>積木組裝</h1>
<p>這把電烏克麗麗，主要使用了三個觸碰感應器，搭配主機上的五個按鈕，因此可以彈奏 <code>40</code> 個音階，組裝方式可以參考 <a href="../../EV3/ElectricUkulee.lxf">ElectricUkulele.lxf</a>，或 <a href="../../EV3/ElectricUkulee.html">線上觀看組裝過程</a>，成品圖如下：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial9-1.jpg" alt="電烏克麗麗"  /></div></div></p>
<p>其實大部份的零件，都是拿來做造型了，控制發音的原理很簡單，左手三個觸碰感應器按下與否會有 <code>8</code> 個狀態，每個狀態下可搭配主機按鈕發出 <code>5</code> 個音階，如果以頻率 <code>261.626</code> 的 C（Do）開始，可以發出的基本音階如下圖：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial9-2.jpg" alt="電烏克麗麗"  /></div></div></p>
<p>左下方的 EV3 就是對應的方向，主機按鈕依左、中、右、上、下的順序，相距都是一個半音，上圖中每個八度裏沒有畫出來的音階，就是半音的部份了，也就是相當於鋼琴的黑鍵部份。</p>
<h1>40 個判斷分支？</h1>
<p>觸碰感應器的按鈕若未按下，輸出值為 <code>0</code>，按下則為輸出值 <code>1</code>，依上頭的規劃，三個觸碰感應器的值組合會有 <code>000</code>、<code>001</code>、<code>010</code>、<code>011</code>、<code>100</code>、<code>101</code>、<code>110</code>、<code>111</code>，主機按鈕依左、中、右、上、下的順序，輸出值分別為 <code>1</code> 到 <code>5</code>。</p>
<p>按照程式設計邏輯，要不就是判斷觸碰感應器的八個狀態值，再去判斷主機按鈕的五個狀態值，要不就列出 <code>0001</code>、<code>0002</code>、<code>0003</code>、<code>0004</code>、<code>0005</code>、<code>0011</code>、<code>0012</code> &hellip; 共 <code>40</code> 個狀態值，總之，就是有 <code>40</code> 個判斷分支，程式很簡單吧！</p>
<p>我可不想這麼做，<code>40</code> 個判斷分支實在太可怕了，而且如果我要再多一個觸控感應器，讓電烏克麗麗可以發出 <code>80</code> 個音階，我又得再多加上 <code>40</code> 個判斷分支，一定有別的方法！</p>
<h1>十二平均律</h1>
<p>稍微摸過樂器的，可能會知道 <a href="http://zh.wikipedia.org/wiki/%E5%8D%81%E4%BA%8C%E5%B9%B3%E5%9D%87%E5%BE%8B">十二平均律</a>，簡單來說，對於一個八度的音程，可被平均切分為十二等分，每個等分是一個半音的音程，例如 C 大調的話，就是 C、C#、D、D# &hellip; 一直到下個高度 C 共八個半音。</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial9-3.jpg" alt="電烏克麗麗"  /></div></div></p>
<p>對這個電烏克麗麗的設計，重要的是知道，這十二等分的劃分，並不是用等差級數，而是用等比級數來劃分，每個半音間的音程，有著 <code>2</code> 的 <code>12</code> 次方根的倍數關係，約為 <code>1.059463</code>，例如 C 的頻率為 <code>261.626</code>，那麼下個半音 C# 就是 <code>261.626 * 1.059463</code>，也就是 <code>277.183</code>，再下個半音 D 就是 <code>277.183 * 1.059463</code>，也就是 <code>293.665</code>，依此類推。</p>
<p>因此，只要一個簡單的算式，就可以從觸碰感應器與主機按鈕的輸出值，計算出要發出的音階頻率，如果要多一個觸碰感應器，也只要在算式中多個變數就可以了，這比硬是用程式邏輯來蠻幹有效率多了，嗯 &hellip; 套句程式界的老生常談 &hellip; 領域知識（Domain knowledge）很重要 &hellip; XD</p>
<h1>程式撰寫</h1>
<p>主要的程式流程很簡單，就是等待主機按鈕按下，取得觸碰感應器與主機按鈕輸出值，轉為頻率令主機發出音階、在主機按鈕放開後停止發音：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial9-4.jpg" alt="電烏克麗麗"  /></div></div></p>
<p>觸碰感應器與主機按鈕輸出被封裝為一個 KeyState 的自訂 Block，因此它有四個輸出值：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial9-5.jpg" alt="電烏克麗麗"  /></div></div></p>
<p>當然，下個 ToHz 自訂 Block 才是重點：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial9-6.jpg" alt="電烏克麗麗"  /></div></div></p>
<p>三個觸碰感應器的值會被當成二進位組合，算出 <code>0</code> 到 <code>7</code> 的值，這就是 <code>a + b * 2 + c * 4</code> 算式的作用，這個值與主機輸出值結合，<code>01</code> 表示未按下觸碰感應器下，按下主機左邊按鈕、<code>02</code> 表示中間按鈕、<code>03</code> 是右邊按鈕、<code>04</code> 是上邊按鈕、<code>05</code> 是下邊按鈕，接下來，<code>11</code> 是按下一個觸碰感應器下，按下主機左邊按鈕、<code>12</code> 表示中間按鈕、<code>13</code> 是右邊按鈕、<code>14</code> 是上邊按鈕、<code>15</code> 是下邊按鈕，依此類推，因此，你要做的值轉換關係是：</p>
<pre class="prettyprint"><code lang="ev3">01 -&gt; 1
02 -&gt; 2
03 -&gt; 3
04 -&gt; 4
05 -&gt; 5
11 -&gt; 6
12 -&gt; 7
13 -&gt; 8
14 -&gt; 9
15 -&gt; 10
21 -&gt; 11
22 -&gt; 12
23 -&gt; 13
24 -&gt; 14
25 -&gt; 15
略 ...
</code></pre>
<p>也就是說，右邊位數每 <code>5</code> 進位，這就是算式 <code>(a + b * 2 + c C* 4) * 5 + d</code> 的作用，對於多變數的算式，EV3 的 Math 方塊可以設定為 ADV，也就是進階設定，直接輸入算式，減少方塊的佔用面積。</p>
<p>頻率起算的部份，因為 EV3 的 Sound 方塊可以設定的頻率範圍為 <code>250</code> 到 <code>10000</code>，因此就使用 <code>261.626</code> 的 C 頻率做起算。</p>
<p>那麼，就可以來段卡農了，只是，這樂器的按鈕組合會不會太難記了？嗯！熟能生巧！多練幾次就好啦！不過，還是有取巧的方式，吉他或烏克麗麗不是有 Tab 譜嗎？就是那種直接標示手指位置的譜，上頭一開始的卡農，我也是寫了個類似 Tab 譜的東西來彈的，連我家六歲的小女兒都彈的出來 &hellip; XD</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial9-7.jpg" alt="電烏克麗麗"  /></div></div></p>

            
           <br><br><div class="ad336-280" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article></main></div></body>
<script src="http://openhome.cc/Gossip/js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
