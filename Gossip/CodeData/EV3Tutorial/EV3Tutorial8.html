<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="EV3 主機可以發出不同頻率的聲音，可以拿來製作個電子樂器，最簡單的作法就是使用顏色感應器，偵測不同顏色來發出不同音階，或者是使用觸碰感應器搭配 EV3 主機上的按鈕來當成鍵盤輸入，這次我則是嘗試使用...">

<meta property="og:locale" content="zh_TW">
<meta property="og:title" content="EV3 Tutorial（8）超音波感應電子琴">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/Gossip/CodeData/EV3Tutorial/EV3Tutorial8.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="EV3 主機可以發出不同頻率的聲音，可以拿來製作個電子樂器，最簡單的作法就是使用顏色感應器，偵測不同顏色來發出不同音階，或者是使用觸碰感應器搭配 EV3 主機上的按鈕來當成鍵盤輸入，這次我則是嘗試使用...">

    <title>EV3 Tutorial（8）超音波感應電子琴</title>

<link rel="stylesheet" href="http://openhome.cc/Gossip/css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="http://openhome.cc/Gossip/css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="http://openhome.cc/Gossip/css/caterpillar.css">
     <script async src="http://openhome.cc/Gossip/google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="EV3Tutorial8.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="http://openhome.cc/Gossip/CodeData/EV3Tutorial/">回 EV3 Tutorial</a>
            <ul class="pure-menu-list">
                <br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../../images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>EV3 Tutorial（8）超音波感應電子琴</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            <p>EV3 主機可以發出不同頻率的聲音，可以拿來製作個電子樂器，最簡單的作法就是使用顏色感應器，偵測不同顏色來發出不同音階，或者是使用觸碰感應器搭配 EV3 主機上的按鈕來當成鍵盤輸入，這次我則是嘗試使用超音波感應器來作個電子琴外觀的樂器。</p>
<h1>積木組裝</h1>
<p>這次超音波感應電子琴的積木組裝，可以下載 <a href="../../EV3/Piano.lxf">Piano.lxf</a>，或者是 <a href="../../EV3/Piano.html">線上觀看組裝過程</a>，組裝完成的成品如下：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial8-1.jpg" alt="超音波感應電子琴"  /></div></div></p>
<p>乍看組裝用了 <code>182</code> 個零件蠻嚇人的，其實按鍵的組裝方式都一樣是這個：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial8-2.jpg" alt="超音波感應電子琴"  /></div></div></p>
<p>因此就看你要組幾個按鍵罷了，我這邊組的是五個按鍵，可以彈個 Do、Re、Mi、Fa、Sol 的曲子，像是瑪莉小羊之類的 &hellip; XD</p>
<p>判斷按下哪個鍵，就是在按鍵按下後，白色擋板會昇起反彈超音波，感應器藉此量測距離並轉換為 EV3 主要應該發出的頻率。</p>
<h1>避免巢狀結構</h1>
<p>感應器相關的程式，基本都是在迴圈中不斷偵測訊號，在這邊為了讓擋板昇起時發音，落下時停止，因此在每次迴圈都偵測距離變化，這還有個目的，就是讓意外反彈的音波不致於發生太多干擾，可以實際測試設個剛好的值，聲音會比較乾淨一些：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial8-3.jpg" alt="超音波感應電子琴"  /></div></div></p>
<p>PlayTone 自訂 Block 的設計是這次的重點，超音波感應器不是個很精確的東西，只能量測大致的距離，因此，你每次量測到的距離可能是不一樣的，只能大致在某個範圍中，例如，這次五個鍵昇起，可能分別量到 <code>3</code>、<code>4</code>、<code>6.7</code>、<code>9.3</code>、<code>12.1</code>，下次可能量到 <code>3.2</code>、<code>4.4</code>、<code>6.5</code>、<code>9.1</code>、<code>11.4</code> 之類的，因此，你不能直接拿來當 Switch 流程積木的比對值。</p>
<p>當然，EV3 本身有 Range 方塊可以使用，是可以多測量幾次，記錄下每個鍵昇起後量測到的範圍，然後使用 Range 搭配 Switch 方塊，不過，嗯！程式畫面會變成可怕的巢狀結構，而且，Swtich 方塊還有個限制，不能直接將資料線從外部拉到 Switch 方塊中，因此你得使用變數方塊，簡單來說，你的程式畫面會整個亂到不行。</p>
<p>這時可以換個方式來設計，例如方法之一，是為每個音階定義一個自訂 Block，每個自訂 Block 中只有一個 Switch 方塊，當距離在 Range 設定的範圍中時，發出該音階的頻率，然後，每次迴圈量得距離後，分出多個流程至各個自訂 Block，只不過這個方法，音階越多流程就分出越多，整體畫面上還是不小，而且為每個音階定義一個自訂 Block 也是蠻麻煩的。</p>
<p>我想到的方法是，不使用 Range，只用一個 Array 方塊，Array 方塊裏的值可能像是：</p>
<pre class="prettyprint"><code lang="ev3">3.391995
4.349228
5.349228
6.329628
7.329628
9.293666
10.29366
11.26163
</code></pre>
<p>嗯？這些值代表什麼意義？很簡單，<code>3.391995</code> 表示當偵測到距離為 <code>3</code> 時，要發出 <code>391.995</code> Hz 的聲音（也就是 Sol），<code>4.349228</code> 與 <code>5.349228</code>，表示偵測到距離為 <code>4</code> 或 <code>5</code> 時，都要發出 <code>349.228</code> Hz 的聲音（也就是 Fa），這表示我的感應器第二個靠近它的擋板昇起時，量到的距離可能是 4.x 也可能是 5.x，類似地，<code>6.329628</code> 與 <code>7.329628</code>，表示偵測到距離為 <code>6</code> 或 <code>7</code> 時，都要發出 <code>329.628</code> Hz 的聲音（也就是 Mi），依此類推 &hellip; 實際的陣列值要以量測為主。</p>
<p>我會用 Round 方塊對感應器量到的距離做四捨五入，這也就是為什麼陣列元素值的整數部份代表偵測到的距離，至於小數點後只要乘上 <code>1000</code> 就是頻率了。</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial8-4.jpg" alt="超音波感應電子琴"  /></div></div></p>
<h1>自訂 Block 來處理算式</h1>
<p>當然，感應器量到的距離與陣列值得跑迴圈進行比對，比對中了就離開發出聲音並離開迴圈，比對的部份要用到算式，凡是用到算式的部份，都建議自訂 Block 處理，因為使用 Math 方塊來做簡單的運算，都可以佔據很大的畫面。</p>
<p>IsMatched 自訂方塊對於陣列元素值直接裁掉小數部份，對於感測到的距離進行四捨五入，然後看看結果整數是否符合：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial8-5.jpg" alt="超音波感應電子琴"  /></div></div></p>
<p>FindHz 自訂方塊則計算出頻率，也就是取得陣列元素值中小數部份，然後乘上 <code>1000</code>：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/EV3Tutorial8-6.jpg" alt="超音波感應電子琴"  /></div></div></p>
<p>這麼一來，如果你要擴充按鍵，也只要增加 Array 的元素值就可以了，不用繼續建立更深的巢狀，也不用自訂更多的 Block 了 &hellip;</p>
<p>幹嘛這麼認真地使用圖型化語言呢？這種語言是有很多限制沒錯，我是可以不用太認真面對它，拖拖拉拉反正程式能動就好，不用考慮可讀性，也不用考慮彈性，好玩就好，不過，真的要認真面對這些限制時，倒是可以激發一些改變設計的可能性，從另一個角度來設計程式，對我來說，這也是蠻有趣的呢！</p>

            
           <br><br><div class="ad336-280" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article></main></div></body>
<script src="http://openhome.cc/Gossip/js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
