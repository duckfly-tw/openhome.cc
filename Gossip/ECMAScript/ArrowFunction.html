<!doctype html><html lang="zh-tw">
<head>
    <meta http-equiv="refresh" content="0; URL=https://openhome.cc/Gossip/ECMAScript/'https://openhome.cc/zh-tw/javascript/es-function/arrow/'">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="在 ES6 之前，使用 function 建立匿名函式是很熟悉的一件事：
&gt; var arr = [1, 2, 5, 2, 5, 6, 9];
undefined
&gt; arr.filter...">

    <meta property="og:locale" content="zh_TW">
    <meta property="og:title" content="箭號函式">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://openhome.cc/Gossip/ECMAScript/ArrowFunction.html">
    <meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
    <meta property="og:site_name" content="OPENHOME.CC">
    <meta property="og:description" content="在 ES6 之前，使用 function 建立匿名函式是很熟悉的一件事：
&gt; var arr = [1, 2, 5, 2, 5, 6, 9];
undefined
&gt; arr.filter...">

    <title>箭號函式</title>

    <link rel="stylesheet" href="../css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="../css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="../css/caterpillar.css">
     <script async src="../google-code-prettify/run_prettify.js"></script>
     <!-- 網頁層級廣告 --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="ArrowFunction.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="https://openhome.cc/Gossip/ECMAScript/">回 JavaScript</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a> </div><br> <div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>箭號函式</h1>
        </header>

        <article class="content">
            <br><div class="ad-3" style="text-align: center;"><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
            <p>在 ES6 之前，使用 <code>function</code> 建立匿名函式是很熟悉的一件事：</p>
<pre class="prettyprint"><code lang="javascript">&gt; var arr = [1, 2, 5, 2, 5, 6, 9];
undefined
&gt; arr.filter(function(elem) {
...     return elem % 2 === 0;
... }).map(function(elem) {
...     return elem * 10;
... });
[ 20, 20, 60 ]
&gt;
</code></pre>
<p>可讀性很差，在 ES6 中，可以寫成：</p>
<pre class="prettyprint"><code lang="javascript">&gt; let arr = [1, 2, 5, 2, 5, 6, 9];
undefined
&gt; arr.filter(elem =&gt; elem % 2 == 0).map(elem =&gt; elem * 10);
[ 20, 20, 60 ]
&gt;
</code></pre>
<p><code>elem =&gt; elem % 2</code> 這個運算式，在 ES6 中稱為箭號函式（Arrow Function），是類似其他語言中被稱為 Lambda 運算式的東西，不過，Lambda 運算式這名詞其實沒有嚴謹的定義，在 ES6 中就用個箭號函式名詞來區別吧！</p>
<p>如果有兩個以上的參數，箭號函式的參數列必須使用 <code>()</code> 包含起來，沒有參數的話，就只要寫 <code>()</code> 就可以了，在只有一行運算式的情況下，<code>=&gt;</code> 右邊的運算式傳回值會自動 <code>return</code> 為箭號函式的傳回值。如果要換行的話，可以使用 <code>{}</code>，最後要傳回值時可以使用 <code>return</code>：</p>
<pre class="prettyprint"><code lang="javascript">&gt; let plus = (a, b) =&gt; a + b;
undefined
&gt; plus(1, 2);
3
&gt; let minus = (a, b) =&gt; {
...     return a - b;
... }
undefined
&gt; minus(10, 5)
5
&gt;
</code></pre>
<p>箭號函式的目的之一，是讓那些運算本體很簡單的函式，可以用簡潔的方式撰寫，因此，雖然可以使用 <code>{}</code>，然而，若本體很長的話，並不建議使用箭號函式。</p>
<p>另一方面，箭號函式也不單純只是 <code>function</code> 匿名函式的簡寫形式，它在 <code>this</code> 方面的解析方式，並不是依照 <code>function</code> 的既有方式，例如。底下是 <code>function</code> 的形式：</p>
<pre class="prettyprint"><code lang="javascript">this.x = 1;

var o = {
    x: 10,
    foo : function() {
        console.log(this.x);
    }
};

o.foo();
</code></pre>
<p>你應該知道執行結果會顯示 10 吧！換成箭號函式的話會如何呢？</p>
<pre class="prettyprint"><code lang="javascript">this.x = 1;

let o = {
    x: 10,
    foo : () =&gt; console.log(this.x)
};

o.foo();
</code></pre>
<p>執行結果會顯示 1，也就是說，箭號函式中的 <code>this</code>，並不是依當時呼叫者來綁定的，而是依當時的語彙（Lexical）環境來綁定，白話的話，就是哪個環境包含箭號函式，而當時環境中的 <code>this</code>，就是箭號函式的 <code>this</code>，一旦綁定了 <code>this</code> 的對象，就不會再改變，就算使用 <code>o.foo.call(o)</code> 也不會改變。</p>
<p>在上面的例子中，包含箭號函式的環境是全域，在全域中寫 <code>this</code> 是什麼物件，就是上例中箭號函式中 <code>this</code> 的物件，此時就像是：</p>
<pre class="prettyprint"><code lang="javascript">let who = this;

this.x = 1;

let o = {
    x: 10,
    foo : function() {
        console.log(who.x);
    }
};

o.foo();
</code></pre>
<p>再來看一個例子：</p>
<pre class="prettyprint"><code lang="javascript">var o = {
    x   : 10,
    foo : function() {
        return {
            x : 20,
            doFoo : function() {
                console.log(this.x);
            }
        }
    }
};

o.foo().doFoo();
</code></pre>
<p>這個比較難一些，也是為什麼 <code>function</code> 中的 <code>this</code> 難以掌握的例子之一，呼叫 <code>o.foo</code> 會傳回一個物件，該物件有個 <code>doFoo</code> 方法，實際上是呼叫 <code>o.foo</code> 傳回的物件在呼叫 <code>doFoo</code> 方法，因此 <code>doFoo</code> 方法中的 <code>this</code> 會是呼叫 <code>o.foo</code> 傳回的物件，該物件上的 <code>x</code> 特性是 20，也就是最後的顯示結果。</p>
<p>換成箭號函式的話：</p>
<pre class="prettyprint"><code lang="javascript">let o = {
    x   : 10,
    foo : function() {
        return {
            x : 20,
            doFoo : () =&gt; console.log(this.x)
        }
    }
};

o.foo().doFoo();
</code></pre>
<p>哪個環境包含了箭號函式呢？<code>foo</code> 特性參考的函式！在該函式中寫 <code>this</code> 的話，代表著 <code>o</code> 參考的物件，因此箭號函式中的 <code>this</code> 代表的就是 <code>o</code> 參考的物件，因此會顯示 10，就像以底下的作用：</p>
<pre class="prettyprint"><code lang="javascript">let o = {
    x   : 10,
    foo : function() {
        var who = this;
        return {
            x : 20,
            doFoo : function() {
                console.log(who.x);
            }
        }
    }
};

o.foo().doFoo();
</code></pre>
<p>如果想更進一步探索的話，箭號函式中若出現 <code>super</code>，也是依當時語彙環境決定的，<code>super</code> 可以出現在〈<a href="EnhancedObject.html">物件實字簡化與增強</a>〉談過的方法簡便定義形式，代表著物件的原型（<code>__proto__</code>），因此底下的程式最後會顯示 10：</p>
<pre class="prettyprint"><code lang="javascript">var o = {
    foo() {

        var o2 = {
            foo2() {
                console.log(super.x);
            }
        };

        o2.__proto__ = {x: 10};     

        o2.foo2();
    }
};

o.__proto__ = {x : 1};

o.foo();
</code></pre>
<p><code>__proto__</code> 算是被列入標準了（儘管不建議使用，ES6 提供了標準化的 <code>Object.setPrototypeOf</code>，之後有機會再介紹），在上例中，分別設定了兩個物件的 <code>__proto__</code>，而 <code>super</code> 是依哪個物件呼叫了方法而綁定的。</p>
<p>如果改成箭號函式的話：</p>
<pre class="prettyprint"><code lang="javascript">var o = {
    foo() {

        var o2 = {
            foo2 : () =&gt; console.log(super.x)
        };

        o2.__proto__ = {x: 10};     

        o2.foo2();
    }
};

o.__proto__ = {x : 1};

o.foo();
</code></pre>
<p>其實如果單看 <code>o2</code> 的定義，是不能有 <code>super</code> 出現的，然而由於有 <code>foo</code> 方法的包覆，而 <code>super</code> 來自於 <code>foo</code> 環境，因此上面的程式得以執行成功，並且顯示 1 的結果。</p>

            
           <br><br><div class="ad336-280" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article>
    </main>
</div></body>
</html>
<script src="../js/ui.js"></script>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
