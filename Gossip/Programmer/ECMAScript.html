<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="iThome 網站首載：從ECMAScript看語言約束
      
      開發者多半討厭語言約束，特別是對新手而言，語言約束總是令他們感到沮喪，為了讓開發者盡可能控制一切，幾近無約束的J...">

<meta property="og:locale" content="zh_TW">
<meta property="og:title" content="從ECMAScript看語言約束">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/Gossip/Programmer/ECMAScript.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="iThome 網站首載：從ECMAScript看語言約束
      
      開發者多半討厭語言約束，特別是對新手而言，語言約束總是令他們感到沮喪，為了讓開發者盡可能控制一切，幾近無約束的J...">


    <title>從ECMAScript看語言約束</title>

<link rel="stylesheet" href="http://openhome.cc/Gossip/css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="http://openhome.cc/Gossip/css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="http://openhome.cc/Gossip/css/caterpillar.css">
     <script async src="http://openhome.cc/Gossip/google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="ECMAScript.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon --><span></span>
        
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="http://openhome.cc/Gossip/Programmer/">回程式人目錄</a>
            <ul class="pure-menu-list">
                <br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>從ECMAScript看語言約束</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
             iThome 網站首載：<a href="http://www.ithome.com.tw/voice/89425">從ECMAScript看語言約束</a><br>
      <br>
      開發者多半討厭語言約束，特別是對新手而言，語言約束總是令他們感到沮喪，為了讓開發者盡可能控制一切，幾近無約束的JavaScript誕生於1995年5月，這被視為玩具的語言鹹魚翻身之後，因為沒有太多語法約束，開發者可盡情地在上頭創造想要的元素，這其中也創造了不少約束開發者的元素，從ECMAScript 5到ECMAScript 6的演進，就能夠瞭解這十幾年來開發上必要的語言約束有哪些。<br>
      <br>
      <dl>
        <dt>ECMAScript 5嚴格模式</dt>
      </dl>
      <br>
      JavaScript在1996年進行標準化，第一個標準化版本ECMA-262於1997年採納，因為Java名稱上具有商標問題，ECMA-262採用了ECMAScript作為語言名稱，JavaScript此後成為了ECMA-262標準的實作語言，現在的瀏覽器幾乎都能支援1999年發佈的ECMA-262第三版以上的實作，又稱ECMAScript 3，對應的實作為JavaScript 1.5，由於一些政治因素，ECMAScript 4發展意見發生分岐，原有規範中的一小部份是就現有功能作了改進，被發佈為ECMAScript 3.1，後來ECMAScript 4被中止，ECMAScript 3.1被改名ECMAScript 5並於2009年發佈，後續2011年又發佈了ECMAscript 5.1。<br>
      <br>
      ECMAScript 5的主要特點之一是可宣告嚴格模式（Strict mode），透過在程式碼中加入<code>'use strict'</code>字串，一些過去被認為不良實踐的語法就會無法使用，嚴格模式下有許多規範是關於識別字名稱使用上的限制，像是沒有使用<code>var</code>宣告的變數無法使用，不能使用<code>with</code>，不能有重複的參數或特性名稱，不能與保留字或既存的識別字名稱衝突（像是<code>arguments</code>），<code>eval</code>函式評估出來的變數不能在外部使用等，很顯然地，這反映了過去語言在範疇（Scope）與名稱空間（Namespace）管理上過於鬆散，因而必須加強範疇與名稱空間管理上的約束。<br>
      <br>
      JavaScript中<code>this</code>的實際對象可以依呼叫者（caller）自動變換，這雖是很強大的彈性但也經常難以掌握，像是ECMAScript 5之前，如果<code>this</code>沒有實際對象，也就是this實際上是<code>null</code>或<code>undefined</code>時，會自動轉換為全域物件，這又會造成許多誤判或誤用的問題，嚴格模式下禁止了這個行為，實際上，為了讓開發者能明確掌握this，函式新增了<code>bind</code>函式，可以讓你固定<code>this</code>的對象傳回新函式，讓<code>this</code>不會隨著呼叫者自動變換，實際上在這之前，開發者為了要能更精確掌握this實際對象，避免不清不楚下發生問題，亦會明確地在使用<code>call</code>或<code>apply</code>函式時指定<code>this</code>的對象。<br>
      <br>
      <dl>
        <dt>針對物件個體化的約束</dt>
      </dl>
      <br>
      JavaScript中開發者幾乎可以控制物件的一切，你可以從一個幾乎完全身無分物的物件開始，根據需求賦予它必要的能力，你也可以將物件的能力剝奪到幾近一無所有，這種基於原型基礎的語言，有利於快速堆砌功能，這也是後來JavaScript鹹魚翻身之後，生態圈得以迅速發展的原因之一，然而就如我先前專欄〈類別與原型的物件管理學〉中談過，這種特性「容易造成維護上的混亂，在應用於工程性偏重的場合，往往得採取某種慣例來約束物件行為...避免開發者直接修改物件的行為與結構」。<br>
      <br>
      ECMAScript 5中搭配嚴格模式，可以使用<code>Object.preventExtensions</code>函式來阻止對物件直接進行擴充，進一步地，還可以定義特性描述器（Property descriptor），搭配<code>Object.defineProperty</code>、<code>Object.defineProperties</code>函式來指定特性是否可修改、刪除或列舉，為了有更明確的語義，還有<code>Object.seal</code>函式可以對物件彌封，被彌封的物件不能擴充或刪除物件上的特性，亦有<code>Object.freeze</code>函式可用來凍結物件，讓物件成為唯讀物件。<br>
      <br>
      物件個體化能力在專案剛啟始、需求變化快的場合很有用，可以快速堆砌功能，然而當專案逐漸邁入維護份量加重的場合時，嚴格模式下對物件個體化的約束，可以讓JavaScript更實質地約束物件行為，語言的約束並非不好，實際上慣例本身也是種約束，如果專案一開始沒有相當程度的慣例約束，後來想貿然加上嚴格模式或直接對物件個體化做出限制，也只會驟然面對龐大的錯誤訊息，不可能直接享用到ECMAScript 5可選用的嚴格模式與物件個體化限制之好處。<br>
      <br>
      <dl>
        <dt>ECMAScript 6區塊範疇、類別與模組</dt>
      </dl>
      <br>
      被中止的ECMAScript 4中一部份後來演變為ECMAScript 6，於2013年凍結了ECMAScript 6草案停止增加新功能，預計於2015年中發佈正式版本，目前Google的V8實現了部份特性，例如，可使用Node.js 0.11版來體驗。在語言的約束上，ECMAScript 6增加了<code>let</code>宣告，與<code>var</code>不同的是，<code>let</code>宣告的變數範疇只限宣告當時所在區塊（Block），也不可以重複宣告同一變數，也不會如同<code>var</code>宣告的變數一樣具有提昇（Hoisting）的特性，這比較符合多數程式語言中變數的特性。<br>
      <br>
      JavaScript是基於原型（Prototype-based）的語言，沒有類別的概念，然而，ECMAScript 6中增加了<code>class</code>、<code>constructor</code>、<code>extends</code>等語法，可支援基於類別（Class-based）的封裝、繼承，乍看似乎基於原型、基於類別兩個系統相互衝突，其實ECMAScript 6的類別語法極為精簡，主要目的讓過去類別風格封裝、繼承模擬的各種作法，能有個標準方式，拆解ECMAScript 6的類別語法後會發現，與現階段使用<code>function</code>模擬類別的常用手法可以一對一對照，某些程度上，ECMAScript 6中規範的類別就像是語法蜜糖。<br>
      <br>
      對於基於類別的語言來說，類別規範了實例的行為與結構，我在RubyConf 2014的〈Understanding Typing. Understanding Ruby.〉中談過，即使是支援物件個體化的Ruby，也可以經由觀察與重構，讓必要的行為座落於適當的<code>module</code>與類別之中，而這概念在JavaScript中也是適用，如果過去曾經使用過慣例上function模擬類別的作法，直接使用ECMAScript 6支援<code>class</code>等的語法，基本上不困難，語義上明確且程式碼也會簡潔許多。<br>
      <br>
      在JavaScript中，名稱空間管理與模組載入是個很大的問題，過去花了許多功夫在各種方案上，甚至有了專門處理這類問題的框架，像是RequireJS，ECMAScript 6中為了解決這類問題規範了模組特性，讓文件本身就是一個模組，可使用<code>export</code>來匯出名稱，使用<code>import</code>來匯入名稱並創造名稱空間，照例地，這過去可能自行以慣例或運用框架來進行約束，ECMAScript 6讓這類議題有了標準作法且語義明確。<br>
      <br>
      <dl>
        <dt>語言約束背後是怎樣的慣例？</dt>
      </dl>
      <br>
      從ECMAScript標準化到ECMAScript 6是個有趣的過程，如同Brendan Eich在為《Effective JavaScript》寫序時提到，在一堆挑戰性高的需求及發瘋般的時程下，他能做的就是讓JavaScript成為一門可被從頭塑造的語言，開發者能依自己的需求來為JavaScript上patch，而這麼多年來，眾多開發者確實也為JavaScript形塑了它應有的樣貌，或說是在JavaScript上累積了許多最佳實踐（Best practice）。<br>
      <br>
      Brendan Eich也談到「所有語言幾乎都是受限地實行常見的最佳實踐」，JavaScript因緣聚會，在幾近無約束的情況下，先累積了諸多開發經驗與慣例，接著回饋至語言本身成為可選的約束，從另一個角度看過來就是，沒有語言會為了整開發者而加入語法約束，語言若在一開始建立好相關的約束，應有其背後的原因，這也就是不要只從語法或關鍵字上來學習語言的原因，應思考相關語法或約束背後，是否為了解決哪些問題，或者是否曾經借鏡於其它語言的使用慣例。<br>
      <br>
      實際上ECMAScript 6尚未正式發佈，而真正各平台會實作採行也需要相當時間，在這之前，可從ECMAScript 6的規範中先吸取其語法約束背後之精神，就當作目前可用的JavaScript實作平台上已有這類約束一般，將來若真要採用ECMAScript 6規範的語法，就不至面臨太大問題，否則在毫無約束之下，即使只是加上個<code>'use strict'</code>，也足夠讓現有程式一片混亂了！<br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <p></p>
      <p></p>
      <ul>
      </ul><br><br><div class="ad336-280" style="text-align: center;"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></article></main></div></body>
<script src="http://openhome.cc/Gossip/js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
