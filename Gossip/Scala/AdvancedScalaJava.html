<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="在Scala中，沒有傳統語言中所謂的運算子（Operator），所有+、-、*、/等都是 操
作方法。如果運算元是AnyVal的子類別，例如Int、Double等，在編譯為.class之後，直接對應...">

<meta property="og:locale" content="zh_TW">
<meta property="og:title" content="進階型態對應探討">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/Gossip/Scala/AdvancedScalaJava.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="在Scala中，沒有傳統語言中所謂的運算子（Operator），所有+、-、*、/等都是 操
作方法。如果運算元是AnyVal的子類別，例如Int、Double等，在編譯為.class之後，直接對應...">


    <title>進階型態對應探討</title>

<link rel="stylesheet" href="../css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="../css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="../css/caterpillar.css">
     <script async src="../google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="AdvancedScalaJava.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon --><span></span>
        
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="https://openhome.cc/Gossip/Scala/">回 Scala 目錄</a>
            <ul class="pure-menu-list">
                <br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>進階型態對應探討</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            在Scala中，沒有傳統語言中所謂的運算子（Operator），所有+、-、*、/等都是<span style="font-weight: bold;"> </span><a href="OperatorMethod.html">操
作方法</a>。如果運算元是AnyVal的子類別，例如Int、Double等，在編譯為.class之後，直接對應至Java的+、-、*、/等運算，除此之外，所有的操作方法，基本上會編譯為<span style="font-weight: bold;">$methodName</span>這樣的名稱。<br><br>舉個例子來說，在 <a href="Method.html">定義操作方法</a> 中的例子：<br><pre class="prettyprint"><code lang="scala">class Complex(val re: Double, val im: Double) {<br>    def + (that: Complex) = new Complex(re + that.re, im + that.im)<br>    def - (that: Complex) = new Complex(re - that.re, im - that.im)<br>    def * (that: Complex) = new Complex(re * that.re - im * that.im,<br>                                        re * that.im + im * that.re)<br>    def / (that: Complex) = {<br>      val d = that.re * that.re + that.im * that.im<br>      new Complex((re * that.re + im * that.im) / d,<br>                  (im * that.re - re * that.im) / d)<br>    }<br>    override def toString =<br>      re + (if (im &lt; 0) " - " + (-im) else " + " + im) + " i"<br><br>}</code></pre><br>在編譯為.class後，其定義如下：<br><div style="margin-left: 40px;">public class Complex extends java.lang.Object implements scala.ScalaObject{<br>&nbsp;&nbsp;&nbsp; public Complex(double, double);<br>&nbsp;&nbsp;&nbsp; public java.lang.String toString();<br>&nbsp;&nbsp;&nbsp; public Complex <span style="color: red;">$div</span>(Complex); &nbsp; &nbsp; &nbsp;// 除 /<br>&nbsp;&nbsp;&nbsp; public Complex <span style="color: red;">$times</span>(Complex); &nbsp; &nbsp;// 乘 * <br>&nbsp;&nbsp;&nbsp; public Complex <span style="color: red;">$minus</span>(Complex); &nbsp; &nbsp;// 減 - <br>&nbsp;&nbsp;&nbsp; public Complex <span style="color: red;">$plus</span>(Complex); &nbsp; &nbsp; // 加 +<br>&nbsp;&nbsp;&nbsp; public double im();<br>&nbsp;&nbsp;&nbsp; public double re();<br>&nbsp;&nbsp;&nbsp; public int $tag()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throws java.rmi.RemoteException;<br>}<br></div><br>所以，如果你真的要呼叫那些在Scala中的運算子，以下是個例子：<br><pre class="prettyprint"><code lang="scala">public class Main {<br>    public static void main(String[] args) {<br>        Complex c1 = new Complex(3, 2);<br>        Complex c2 = new Complex(2, 3);<br>        Complex rc = c1.$plus(c2);<br>        System.out.println(rc);<br>    }<br>}</code></pre><br>以下為Scala運算子編譯為.class後的名稱對照：<br><table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2"><tbody><tr><td style="font-weight: bold;">Scala</td><td style="font-weight: bold;">Java</td></tr><tr><td>+</td><td>$plus</td></tr><tr><td>-</td><td>$minus</td></tr><tr><td>*</td><td>$times</td></tr><tr><td>/</td><td>$div</td></tr><tr><td>%</td><td>$percent</td></tr><tr><td>&amp;</td><td>$amp</td></tr><tr><td>|</td><td>$bar</td></tr><tr><td>^</td><td>$up</td></tr><tr><td>!</td><td>$bang</td></tr><tr><td>~</td><td>$tilde</td></tr><tr><td>?</td><td>$qmark</td></tr><tr><td>#</td><td>$hash</td></tr><tr><td>:</td><td>$colon</td></tr><tr><td>\</td><td>$bslash</td></tr><tr><td>@</td><td>$at</td></tr><tr><td>&gt;</td><td>$greater</td></tr><tr><td>=</td><td>$eq</td></tr><tr><td>&lt;</td><td>$less</td></tr></tbody></table><br>如果是::這樣連續兩個符號，則編譯後會變成$colon$colon這樣的名稱。<br>
<br>在Scala中，<a href="FirstClassFunction.html">一級函式（First-class function）</a>其實都是FunctionN的實例，其中N為數字，代表參數個數。例如：<br><pre class="prettyprint"><code lang="scala">trait Fun {<br>    def f1(x: () =&gt; String)<br>    def f2(x: (String) =&gt; String)<br>    def f3(x: (String, String) =&gt; String)<br>    def f3(x: (String, String, String) =&gt; String)<br>}</code></pre><br>

在編譯為.class後，其定義為：<br><div style="margin-left: 40px;">i<span style="font-weight: bold; font-family: Courier New,Courier,monospace;">mport scala.Function0;</span><br><span style="font-weight: bold;">import scala.Function1;</span><br><span style="font-weight: bold;">import scala.Function2;</span><br><span style="font-weight: bold;">import scala.Function3;</span><br><br><span style="font-weight: bold;">public&nbsp;interface Fun {</span><br><span style="font-weight: bold;">&nbsp; public&nbsp;void f3(Function3&lt;String, String, String, String&gt; paramFunction3);</span><br><span style="font-weight: bold;">&nbsp; public&nbsp;void f3(Function2&lt;String, String, String&gt; paramFunction2);</span><br><span style="font-weight: bold;">&nbsp; public&nbsp;void f2(Function1&lt;String, String&gt; paramFunction1);</span><br><span style="font-weight: bold;">&nbsp; public&nbsp;void f1(Function0&lt;String&gt; paramFunction0);</span><br><span style="font-weight: bold;">}</span><br></div><br>在&lt;
&gt;的泛型宣告中，最後一個是代表Scala中的傳回值型態，前幾個則是參數型態。實際想在Java中使用Scala所宣告的函式物件會更為複雜（而失去這麼作的意義），因為FunctionN在Scala中是特徵（Trait），以Function1為例：<br><pre class="prettyprint"><code lang="scala">package scala<br>trait Function1[-T1, +R] extends AnyRef { self =&gt; <br>  def apply(v1:T1): R<br>  override def toString() = "&lt;function&gt;"<br>  def compose[A](g: A =&gt; T1): A =&gt; R = { x =&gt; apply(g(x)) }<br>  def andThen[A](g: R =&gt; A): T1 =&gt; A = { x =&gt; g(apply(x)) }<br>}</code></pre><br>編譯為Java所產生的.class之一Function1.class為介面（interface）定義：<br><div style="margin-left: 40px;"><span style="font-weight: bold;">package scala;<br><br>public abstract interface Function1&lt;T1, R&gt; extends ScalaObject {<br>&nbsp; public abstract &lt;A&gt; Function1&lt;T1, A&gt; andThen(Function1&lt;R, A&gt; paramFunction1);<br>&nbsp; public abstract &lt;A&gt; Function1&lt;A, R&gt; compose(Function1&lt;A, T1&gt; paramFunction1);<br>&nbsp; public abstract String toString();<br>&nbsp; public abstract R apply(T1 paramT1);<br>}</span></div><br>函式的執行本體最主要是定義在apply()方法之中，所以就算你打算忽略其它的方法，也得這麼實作：<br><div style="margin-left: 40px;">Function1&lt;String, String&gt; f = new Function1&lt;String, String&gt;() {<br>&nbsp;&nbsp;&nbsp; public &lt;A&gt; Function1&lt;String, A&gt; andThen(Function1&lt;String, A&gt; f) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return null;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; public &lt;A&gt; Function1&lt;A, String&gt; compose(Function1&lt;A, String&gt; f) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return null;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; public int $tag() throws java.rmi.RemoteException {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; public String toString() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "&lt;function&gt;";<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; public String apply(String paramT1) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return paramT1 + "...Orz";<br>&nbsp;&nbsp;&nbsp; }<br>};<br></div><br><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">再來談到 </span><a href="TraitAsCommImpl.html">作為共用實作的特徵</a><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">，例如：<br></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"></span><pre class="prettyprint"><code lang="scala">trait Ordered {<br>    def compare(that: Any): Int<br>    def &lt; (that: Any) = compare(that) &lt; 0<br>    def &lt;=(that: Any) = (this &lt; that) || (this == that)<br>    def &gt; (that: Any) = !(this &lt;= that)<br>    def &gt;=(that: Any) = !(this &lt; that)<br>}</code></pre><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br><span style="font-family: Times New Roman,Times,serif;">在編譯為Java之後，會產生Ordered.class與Ordered$class.class，其中Ordered以介面定義了必須實作的方法，而Ordered$class為實作的部份：<br></span></span><div style="margin-left: 40px;"><span style="font-weight: bold;">// Ordered.class</span><br><span style="font-weight: bold;">import scala.ScalaObject;</span><br><span style="font-weight: bold;"><br>public interface Ordered extends ScalaObject {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public abstract boolean $greater$eq(Object obj);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public abstract boolean $greater(Object obj);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public abstract boolean $less$eq(Object obj);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public abstract boolean $less(Object obj);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public abstract int compare(Object obj);</span><br><span style="font-weight: bold;">}</span><br><br><span style="font-weight: bold;">// Ordered$class.class<br>import scala.runtime.BoxesRunTime;</span><br><br><span style="font-weight: bold;">public abstract class Ordered$class {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public static void $init$(Ordered ordered) { }</span><br><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public static boolean $greater$eq(Ordered $this, Object that) {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return !$this.$less(that);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public static boolean $greater(Ordered $this, Object that) {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return !$this.$less$eq(that);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public static boolean $less$eq(Ordered $this, Object that) {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $this.$less(that) || BoxesRunTime.equals($this, that);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public static boolean $less(Ordered $this, Object that) {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $this.compare(that) &lt; 0;</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><span style="font-weight: bold;">}</span><br><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: Times New Roman,Times,serif;"></span></span></div><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: Times New Roman,Times,serif;"><br>也就是說，如果你真的要在Java中實現Scala中的這個類別：<br></span></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: Times New Roman,Times,serif;"></span></span><pre class="prettyprint"><code lang="scala">class Ball(val radius: Int) <span style="font-weight: bold;">extends Ordered</span> {<br>    def compare(a: Any) = a match {<br>        ...<br>    }<br>    ...<br>}<br></code></pre><br>那麼你必須類似這麼作：<br><div style="margin-left: 40px;"><span style="font-weight: bold;">public class Ball <span style="color: red;">implements Ordered</span>, ScalaObject {</span><br><span style="font-weight: bold;">&nbsp; &nbsp; ....</span><br><span style="font-weight: bold;">&nbsp; &nbsp; public int compare(Object a) {</span><br><span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp; ...</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><span style="font-weight: bold;">&nbsp; &nbsp; public boolean $greater$eq(Object x$1) {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Ordered.class.$greater$eq(this, x$1);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public boolean $greater(Object x$1) {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Ordered.class.$greater(this, x$1);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public boolean $less$eq(Object x$1) {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Ordered.class.$less$eq(this, x$1);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public boolean $less(Object x$1) {</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Ordered.class.$less(this, x$1);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; }</span><br><span style="font-weight: bold;">}</span><br></div><br>再來談談 <a href="StructuralTyping.html">結構型態（Structural typing）</a>，例如：<br><pre class="prettyprint"><code lang="scala">class XD {<br>    def doQuack(d: {def quack: String}) {<br>        println(d.quack)<br>    }<br>}</code></pre><br>在編譯為.class後，其定義為：<br><div style="margin-left: 40px;"><span style="font-weight: bold;">public class XD extends java.lang.Object implements scala.ScalaObject{</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public XD();</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public void doQuack(java.lang.Object);</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public int $tag()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throws java.rmi.RemoteException;</span><br><span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; public static java.lang.reflect.Method reflMethod$Method1(java.lang.Class)</span><br><span style="font-weight: bold;">}</span><br></div><br>再明顯不過，doQuack()的參數型態為Object，而在內部，使用了反射（Reflection）來呼叫指定的方法。<br>
        




<br><br><div class="ad336-280" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>

  </article></main></div></body>
<script src="../js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
