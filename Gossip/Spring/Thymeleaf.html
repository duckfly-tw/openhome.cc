<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="或許你曾經聽說過或看過「JSP 已經過時了」這類的論調，當然，這論調也有許多開發者不認同，你可以在網路上搜尋看看兩造人馬的說法，這邊並不評論 JSP 是否過時了這件事。
不過，JSP 確實不是唯一的頁...">

    <meta property="og:locale" content="zh_TW">
    <meta property="og:title" content="關於 Thymeleaf">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://openhome.cc/Gossip/Spring/Thymeleaf.html">
    <meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
    <meta property="og:site_name" content="OPENHOME.CC">
    <meta property="og:description" content="或許你曾經聽說過或看過「JSP 已經過時了」這類的論調，當然，這論調也有許多開發者不認同，你可以在網路上搜尋看看兩造人馬的說法，這邊並不評論 JSP 是否過時了這件事。
不過，JSP 確實不是唯一的頁...">

    <title>關於 Thymeleaf</title>

    <link rel="stylesheet" href="../css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="../css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="../css/caterpillar.css">
     <script async src="../google-code-prettify/run_prettify.js"></script>
     <!-- 網頁層級廣告 --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="Thymeleaf.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">回 Spring</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a></div><br> <div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>關於 Thymeleaf</h1>
        </header>

        <article class="content">
            <br><div class="ad-3" style="text-align: center;"><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
            <p>或許你曾經聽說過或看過「JSP 已經過時了」這類的論調，當然，這論調也有許多開發者不認同，你可以在網路上搜尋看看兩造人馬的說法，這邊並不評論 JSP 是否過時了這件事。</p>
<p>不過，JSP 確實不是唯一的頁面呈現技術，如果你瞭解 JSP，有機會也可以接觸其他模版引擎，未來在評估採用何種頁面呈現技術時，總是可以多個選擇。</p>
<p>如果使用 Spring MVC，在模版引擎的選擇上，能見度高的選擇之一是 <a href="https://www.thymeleaf.org/">Thymeleaf</a>，也是 Spring Boot 推薦的模版引擎，它主打的特性之一是自然模版（Natural template），模版頁面本身是只需瀏覽器就可檢視的 HTML，例如：</p>
<pre class="prettyprint"><code lang="java">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;Gossip 微網誌&lt;/title&gt;
        &lt;link rel="stylesheet" href="css/gossip.css" type="text/css"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="login"&gt;
            &lt;div&gt;
                &lt;img src='images/caterpillar.jpg' alt='Gossip 微網誌'/&gt;
            &lt;/div&gt;    
            &lt;a href='register'&gt;還不是會員？&lt;/a&gt;
            &lt;p&gt;&lt;/p&gt;

    &lt;ul th:if="${errors != null}" style='color: rgb(255, 0, 0);'&gt;
        &lt;li th:each="error : ${errors}" th:text="${error}"&gt;error message&lt;/li&gt;
    &lt;/ul&gt; 

            &lt;form method='post' action='login'&gt;
                &lt;table&gt;
                    &lt;tr&gt;
                        &lt;td colspan='2'&gt;會員登入&lt;/td&gt;
                    &lt;tr&gt;
                        &lt;td&gt;名稱：&lt;/td&gt;
                        &lt;td&gt;&lt;input type='text' name='username'
                                   th:value="${param.username}"&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;密碼：&lt;/td&gt;
                        &lt;td&gt;&lt;input type='password' name='password'&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td colspan='2' align='center'&gt;
                             &lt;input type='submit' value='登入'&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td colspan='2'&gt;
                             &lt;a href='forgotPwd.html'&gt;忘記密碼？&lt;/a&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/form&gt;
        &lt;/div&gt;
        &lt;div&gt;
            &lt;h1&gt;Gossip ... XD&lt;/h1&gt;
            &lt;ul&gt;
                &lt;li&gt;談天說地不奇怪&lt;/li&gt;
                &lt;li&gt;分享訊息也可以&lt;/li&gt;
                &lt;li&gt;隨意寫寫表心情&lt;/li&gt;
            &lt;/ul&gt;
          &lt;table style='background-color:#ffffff;'&gt; 
           &lt;thead&gt;
               &lt;tr&gt;
                   &lt;th&gt;&lt;hr&gt;&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;

            &lt;tr th:each="message : ${newest}"&gt;
                &lt;td style='vertical-align: top;'&gt;
                  &lt;span th:text="${message.username}"&gt;user name&lt;/span&gt;&lt;br&gt; 
                  &lt;span th:utext="${message.blabla}"&gt;blabla&lt;/span&gt;&lt;br&gt;
                  &lt;span th:text="${message.localDateTime}"&gt;time here&lt;/span&gt;         
                        &lt;hr&gt;
                &lt;/td&gt;            
            &lt;/tr&gt;               

        &lt;/tbody&gt;
         &lt;/table&gt;

        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>這是一個完全合法的 HTML 文件，直接在瀏覽器上開啟，也可以顯示原型頁面：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/Thymeleaf-1.JPG" alt="關於 Thymeleaf"  /></div></div></p>
<p>如果沒有在 Web 容器上運行，使用瀏覽器來直接開啟一個 JSP 檔案，只會直接顯示 JSP 原始碼內容而已。</p>
<p>如果想在 Spring MVC 中改用 Thymeleaf 模版作為呈現技術，可以在 build.gradle 裏頭加入：</p>
<pre class="prettyprint"><code lang="java">compile 'org.thymeleaf:thymeleaf-spring5:3.0.11.RELEASE'
</code></pre>
<p>並在 <code>WebConfig</code> 中替換 <code>ViewResolver</code> 實作：</p>
<pre class="prettyprint"><code lang="java">package cc.openhome.web;

...略

@Configuration
@EnableWebMvc
@PropertySource("classpath:path.properties")
@ComponentScan("cc.openhome.controller")
public class WebConfig implements WebMvcConfigurer, ApplicationContextAware {
    private ApplicationContext applicationContext;

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.applicationContext = applicationContext;
    }  

    ...略

    @Bean
    public ITemplateResolver templateResolver() {
        // 透過此實例進行相關設定，後續用來建立模版引擎物件
        SpringResourceTemplateResolver resolver = new SpringResourceTemplateResolver();
        resolver.setApplicationContext(applicationContext);

        // 開發階段可設定為不快取模版內容，修改模版才能即時反應變更
        resolver.setCacheable(false);
        // 搭配控制器傳回值的前置名稱
        resolver.setPrefix("/WEB-INF/templates/");
        // 搭配控制器傳回值的後置名稱
        resolver.setSuffix(".html");
        // HTML 頁面編碼
        resolver.setCharacterEncoding("UTF-8");
        // 這是一份 HTML 文件
        resolver.setTemplateMode(TemplateMode.HTML);
        return resolver;
    }

    @Bean
    public SpringTemplateEngine templateEngine(ITemplateResolver templateResolver) {
        // 建立與設定模版引擎
        SpringTemplateEngine engine = new SpringTemplateEngine();
        engine.setEnableSpringELCompiler(true);
        engine.setTemplateResolver(templateResolver);
        return engine;
    }

    @Bean
    public ViewResolver viewResolver(SpringTemplateEngine engine) {
        // 建立ViewResolver實作物件並設置模版引擎實例
        ThymeleafViewResolver resolver = new ThymeleafViewResolver();
        resolver.setTemplateEngine(engine);
        // 回應內容編碼
        resolver.setCharacterEncoding("UTF-8");
        resolver.setCache(false);
        return resolver;
    }    
}
</code></pre>
<p>接下來，就可以將 JSP 頁面，逐一改造為 Thymeleaf 的 HTML 模版，詳細說明 Thymeleaf 的 HTML 模版如何撰寫，不在這系列的文件設定範圍內，然而，若有 JSTL 或其他模版引擎的使用經驗，學習 Thymeleaf 模版的撰寫並不困難，這部份可參考官方文件〈<a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Tutorial: Using Thymeleaf</a>〉。</p>
<p>雖然不打算說明如何撰寫 Thymeleaf 的 HTML 模版，然而 <a href="https://github.com/JustinSDK/Spring5Tutorial/tree/master/labs/solutions/MVC/Thymeleaf/gossip">gossip</a> 中已經將全部的 JSP 改寫為 Thymeleaf 的 HTML 模版，可作為參考之用。</p>

            
           <br><br><div class="ad336-280" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article>
    </main>
</div></body>
</html>
<script src="../js/ui.js"></script>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
