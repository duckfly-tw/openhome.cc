<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Hibernate
中將物件與資料庫表格映射關係連接起來的是映射文件，如果使用XML來定義，通常以*.hbm.xml作為檔案名稱，如果要使用Annotation直接定義在.java檔案之中，可以參考...">

<meta property="og:locale" content="zh_TW">
<meta property="og:title" content="映射文件">
<meta property="og:type" content="article">
<meta property="og:url" content="https://openhome.cc/Gossip/HibernateGossip/HibernateHbmFile.html">
<meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
<meta property="og:site_name" content="OPENHOME.CC">
<meta property="og:description" content="Hibernate
中將物件與資料庫表格映射關係連接起來的是映射文件，如果使用XML來定義，通常以*.hbm.xml作為檔案名稱，如果要使用Annotation直接定義在.java檔案之中，可以參考...">


    <title>映射文件</title>

<link rel="stylesheet" href="../css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="../css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="../css/caterpillar.css">
     <script async src="../google-code-prettify/run_prettify.js"></script>
<!-- 網頁層級廣告 --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="HibernateHbmFile.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon --><span></span>
        
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">回 Hibernate 目錄</a>
            <ul class="pure-menu-list">
                <br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a> </div><br><div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>映射文件</h1>
        </header>

        <article class="content"><br><div class="ad-3" style="text-align: center;"><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
          Hibernate
中將物件與資料庫表格映射關係連接起來的是映射文件，如果使用XML來定義，通常以*.hbm.xml作為檔案名稱，如果要使用Annotation直接定義在.java檔案之中，可以參考 <a href="HibernateAnnotation.html">Hibernate Annotations</a>。<br>











      <br>











XML映射文件可以手工撰寫，或是透過工具程式從資料庫表格自動生
成，可以參考 <a href="TableToHbmPOJO.html">從資
料表生成映射文件與POJO</a>。<br>











      

      <br>














來看看一個基本的映射文件如何撰寫：
      <br>














      
      
      
      
      
      
      
      
      
      
      
      
      
      <ul>













        <li>User.hbm.xml</li>













      
      
      
      
      
      
      
      
      
      
      
      
      
      </ul>














      
      
      
      
      
      
      
      
      
      
      
      
      
      <pre>&lt;?xml version="1.0" encoding="utf-8"?&gt; <br>&lt;!DOCTYPE hibernate-mapping <br> PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" <br> "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt; <br><br>&lt;hibernate-mapping&gt; <br>    &lt;!--類別名稱與表格名稱映射--&gt;<br>    &lt;class name="onlyfun.caterpillar.User" table="user"&gt; <br>        &lt;!--id與主鍵映射--&gt;<br>        &lt;id name="id" column="id"&gt; <br>            &lt;generator class="native"/&gt; <br>        &lt;/id&gt; <br>        &lt;!--類別屬性與表格欄位的映射--&gt;<br>        &lt;property name="name" column="name"/&gt; <br>        &lt;property name="age" column="age"/&gt; <br>    &lt;/class&gt; <br>&lt;/hibernate-mapping&gt;</pre>














      <br>













      
映射文件中主要包括三個部份：類別名稱與表格名稱的映射、id屬性與主鍵的映射、類別屬性與表格欄位的映射。<br>













      <br>














這份映射文件對應於以下的類別與表格：
      <br>














      
      
      
      
      
      
      
      
      
      
      
      
      
      <ul>













        <li>User.java</li>













      
      
      
      
      
      
      
      
      
      
      
      
      
      </ul>














      
      
      
      
      
      
      
      
      
      
      
      
      
      <pre>package onlyfun.caterpillar;<br><br>public class User {<br>    private Integer id;<br>    private String name;<br>    private Integer age;<br> <br>    // 必須要有一個預設的建構方法<br>    // 以使得Hibernate可以使用Constructor.newInstance()建立物件<br>    public User() {}<br><br>    public Integer getId() {<br>        return id;<br>    }<br><br>    public void setId(Integer id) {<br>        this.id = id;<br>    }<br><br>    public String getName() {<br>        return name;<br>    }<br><br>    public void setName(String name) {<br>        this.name = name;<br>    }<br> <br>    public Integer getAge() {<br>        return age;<br>    }<br><br>    public void setAge(Integer age) {<br>        this.age = age;<br>    }<br>}</pre>














      <br>














      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <ul>













        <li>user 表格</li>













      
      
      
      
      
      
      
      
      
      
      
      
      
      </ul>














      
      
      
      
      
      
      
      
      
      
      
      
      
      <div class="cmd"><span style="color: rgb(255, 255, 255);">&nbsp;+-------+------------------+------+------+----------+---------------------+<br>














&nbsp;| Field |
Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp; &nbsp;&nbsp; | Null | Key&nbsp; |
Default&nbsp; | Extra&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
|<br>


&nbsp;+-------+------------------+------+------+----------+---------------------+<br>


&nbsp;| id&nbsp;&nbsp;&nbsp; |
int(11)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp; |&nbsp;
&nbsp; &nbsp; | PRI &nbsp;|
NULL&nbsp;&nbsp; &nbsp; | auto_increment &nbsp; &nbsp; &nbsp;|<br>














&nbsp;| name &nbsp;| varchar(100)
&nbsp; &nbsp; |&nbsp;
&nbsp; &nbsp; |&nbsp;&nbsp;
&nbsp;
&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; |<br>














&nbsp;| age&nbsp;&nbsp; |
int(11)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp; | YES&nbsp;&nbsp;|&nbsp; &nbsp;
&nbsp; | NULL&nbsp;
&nbsp; &nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;|&nbsp; <br>














&nbsp;+-------+------------------+------+------+----------+---------------------+</span><span style="color: rgb(255, 255, 255);"><br>














            </span></div>














      <br>













      
在&lt;id&gt;或&lt;property&gt;的設定上，name設定類別上的屬性名，而column對應至表格欄位，如果屬性名稱與欄位名稱相同，則可以省略column屬性設定。<br>











      <br>











&lt;id&gt;或&lt;property&gt;上，可以設定type屬性，在type上可以設定Java類別的資料
型態，但由於
Java的資料型態與資料庫的資料型態並不是一對一對應的，為此Hibernate提供它自己的資料型態，作為Java資料型態與資料庫資料型態的連接型
態，下面的表格列出型態之間的對應：
      
      
      
      
      
      
      
      
      
      
      
      
      
      <table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">














        <tbody>














          <tr>














            <td style="background-color: rgb(204, 204, 204);">Java
資料型態</td>














            <td style="background-color: rgb(204, 204, 204);">Hibernate
資料型態</td>














            <td style="background-color: rgb(204, 204, 204);">標
準SQL資料型態</td>














          </tr>














          <tr>














            <td>byte、java.lang.Byte</td>














            <td>byte</td>














            <td>TINYINT</td>














          </tr>














          <tr>














            <td>short、java.lang.Short</td>














            <td>short</td>














            <td>SMALLINT</td>














          </tr>














          <tr>














            <td>int、java.lang.Integer</td>














            <td>integer</td>














            <td>INGEGER</td>














          </tr>














          <tr>














            <td>long、java.lang.Long</td>














            <td>long</td>














            <td>BIGINT</td>














          </tr>














          <tr>














            <td>float、java.lang.Float</td>














            <td>float</td>














            <td>FLOAT</td>














          </tr>














          <tr>














            <td>double、java.lang.Double</td>














            <td>double</td>














            <td>DOUBLE</td>














          </tr>














          <tr>














            <td>java.math.BigDecimal</td>














            <td>big_decimal</td>














            <td>NUMERIC</td>














          </tr>














          <tr>














            <td>char、java.lang.Character</td>














            <td>character</td>














            <td>CHAR(1)</td>














          </tr>














          <tr>














            <td>boolean、java.lang.Boolean</td>














            <td>boolean</td>














            <td>BIT</td>














          </tr>














          <tr>














            <td>java.lang.String</td>














            <td>string</td>














            <td>VARCHAR</td>














          </tr>














          <tr>














            <td>boolean、java.lang.Boolean</td>














            <td>yes_no</td>














            <td>CHAR(1)('Y'或'N')</td>














          </tr>














          <tr>














            <td>boolean、java.lang.Boolean</td>














            <td>true_false</td>














            <td>CHAR(1)('Y'或'N')</td>














          </tr>














          <tr>














            <td>java.util.Date、java.sql.Date</td>














            <td>date</td>














            <td>DATE</td>














          </tr>














          <tr>














            <td>java.util.Date、java.sql.Time</td>














            <td>time</td>














            <td>TIME</td>














          </tr>














          <tr>














            <td>java.util.Date、java.sql.Timestamp</td>














            <td>timestamp</td>














            <td>TIMESTAMP</td>














          </tr>














          <tr>














            <td>java.util.Calendar</td>














            <td>calendar</td>














            <td>TIMESTAMP</td>














          </tr>














          <tr>














            <td>java.util.Calendar</td>














            <td>calendar_date</td>














            <td>DATE</td>














          </tr>














          <tr>














            <td>byte[]</td>














            <td>binary</td>














            <td>VARBINARY、BLOB</td>














          </tr>














          <tr>














            <td>java.lang.String</td>














            <td>text</td>














            <td>CLOB</td>














          </tr>














          <tr>














            <td>java.io.Serializable</td>














            <td>serializable</td>














            <td>VARBINARY、BLOB</td>














          </tr>














          <tr>














            <td>java.sql.Clob</td>














            <td>clob</td>














            <td>CLOB</td>














          </tr>














          <tr>














            <td>java.sql.Blob</td>














            <td>blob</td>














            <td>BLOB</td>














          </tr>














          <tr>














            <td>java.lang.Class</td>














            <td>class</td>














            <td>VARCHAR</td>














          </tr>














          <tr>














            <td>java.util.Locale</td>














            <td>locale</td>














            <td>VARCHAR</td>














          </tr>














          <tr>














            <td>java.util.TimeZone</td>














            <td>timezone</td>














            <td>VARCHAR</td>














          </tr>














          <tr>














            <td>java.util.Currency</td>














            <td>currency</td>














            <td>VARCHAR</td>














          </tr>














        
        
        
        
        
        
        
        
        
        
        
        
        
        </tbody>
      
      
      
      
      
      
      
      
      
      
      
      
      
      </table>














      <br>











      一個設定的方式如下所示：<br>











      
      
      
      
      
      
      
      
      
      
      
      
      <div style="margin-left: 40px;"><span style="font-weight: bold;">&lt;property name="name" column="name" <span style="color: rgb(255, 0, 0);">type="string"</span>/&gt; </span><br>











      </div>














      <br>











      每個內建的Hibernate類型，在
org.hibernate.Hibernate類別中都有對應的常數，例如Hibernate.STRING。基本上，Hibernate會使用
Reflection自動找出屬性的資料型態，所以type屬性在使用POJO時可以省略不設，如果有特別設定，則Hibernate就不用使用
Reflection來找出類型，不過在使用 <a href="DynamicModel.html">動
態模型（Dynamic
Model）</a>，type屬性則是必須設定的，用以得知動態模型中應放入哪種類型的物件。<br>











      <br>











      &lt;generator&gt;設定主鍵的生成方式，可以設定"native"表示由Hibernate自動根據Dialect選擇
採用
identity、hilo、sequence等作為主鍵生成方式，也可以考慮採用uuid由Hibernate根據128位元UUID演算法（128-
bit UUID algorithm）生成16進位制數值，並編碼為32位長度的字串，還有其它的主鍵生成方式，可以參考官方手冊的 <a href="http://www.hibernate.org/hib_docs/v3/reference/en/html/mapping.html#mapping-declaration-id-generator">Generator</a>
說明。<br>










      <br>










您可以在&lt;hibernate-mapping&gt;上設定package屬性，如此一來，文件中要設置類別名稱時，就不用寫出完整的package，例如：<br>










      
      
      
      
      
      
      
      
      
      
      
      <div style="margin-left: 40px;">&lt;hibernate-mapping <span style="color: rgb(255, 0, 0);">package="onlyfun.caterpillar"</span>&gt; <br>










      &nbsp;&nbsp;&nbsp; &lt;!--類別名稱與表格名稱映射--&gt;<br>










      &nbsp;&nbsp;&nbsp; &lt;class name="<span style="color: rgb(255, 0, 0);">User</span>" table="user"&gt; <br>










      &nbsp; &nbsp; &nbsp; &nbsp; ....<br>










      &nbsp;&nbsp;&nbsp; &lt;/class&gt; <br>










      &lt;/hibernate-mapping&gt;<br>










      </div>










      <br>













      在使用HQL時，您可以只使用類別名稱來替代完整名稱：<br>









      
      
      
      
      
      
      
      
      
      
      <div style="margin-left: 40px;">// 相當於寫"from onlyfun.caterpillar.User"<br>









      </div>









      
      
      
      
      
      
      
      
      
      <div style="margin-left: 40px;">Query query = session.createQuery("from User");&nbsp;<br>









      </div>









      
      <br>









這是Hibernate的auto-import功能，然而如果在不同的package下都有User類別，則Hibernate將無從得知是要使用哪個User類別，您可以在&lt;hibernate-mapping&gt;上設定<span style="font-weight: bold;">auto-import</span>屬性為false，關閉auto-import功能，並在HQL中撰寫完整的類別名稱。<br>









      <br>









另一種解決的方式，是在&lt;hibernate-mapping&gt;中使用&lt;import&gt;設定別名，例如：<br>









      
      
      
      
      
      
      
      
      
      
      <div style="margin-left: 40px;">&lt;hibernate-mapping<span style="color: rgb(255, 0, 0);"></span>&gt; <br>









      &nbsp; &nbsp; &lt;import class="onlyfun.caterpillar.User" rename="<span style="color: rgb(255, 0, 0);">DemoUser</span>"/&gt;<br>









      &lt;/hibernate-mapping&gt;<br>









      </div>










      
      <br>









      之後在指定HQL中，即可使用這個別名：<br>









      
      
      
      
      
      
      
      
      
      
      <div style="margin-left: 40px;">Query query = session.createQuery("from <span style="color: rgb(255, 0, 0);">DemoUser</span>");&nbsp;<br>









      </div>









      <br>









      
      對於一些不能為空的屬性，可以在&lt;property&gt;上加上not-null屬性為true，如此Hibernate可以直接檢查屬性是否為null，而不用等進入到資料庫中再作檢查。<br>






      <br>






如果有某個屬性，其值取決於表格欄位自己產生的值，而非程式中主動設定的值，例如資料新增時，會由資料庫產生新增時的時間，而這個值想要主動提取至物件的對應屬性，則可以在&lt;property&gt;上設定generated屬性，例如：<br>






      
      
      
      
      
      
      
      <div style="margin-left: 40px;">...<br>






      <span style="font-weight: bold;">&nbsp; &nbsp; &lt;property name="time" column="time" </span><br>






      <span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; insert="false" update="false" generated="always"/&gt;</span><br>






      ...<br>






      </div>






      <br>






如上設定之後，當物件儲存時，time屬性並不會參與儲存，而是由資料庫產生time欄位值，再SELECT出來設定給time屬性，由於並非實際要儲存屬性，所以設定insert為false，而由於這個欄位由資料庫維護，所以update設定為false。<br>






      <br>







      如果物件上有個屬性，實際上並沒有欄位與之對應，您只是想藉由資料庫中的欄位查詢來取得，例如使用COUNT函式來取得所有的筆數，則您可以使用formula屬性，例如：<br>





      
      
      
      
      
      
      <div style="margin-left: 40px;"><span style="font-weight: bold;">...</span><br>





      <span style="font-weight: bold;">&nbsp; &nbsp; &lt;property name="average" formula="(SELECT AVG(u.age) FROM T_USER u)"/&gt;</span><br>





      <span style="font-weight: bold;">...</span><br>





      </div>





      
      <br>






      <br>



<br><br><div class="ad336-280" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></article></main></div></body>
<script src="../js/ui.js"></script>
</html>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
