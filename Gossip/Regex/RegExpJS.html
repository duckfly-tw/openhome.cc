<!doctype html><html lang="zh-tw">
<head>
    <meta http-equiv="refresh" content="0; URL=https://openhome.cc/Gossip/Regex/'https://openhome.cc/zh-tw/regex/javascript/regexp/'">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="規則表示式字面值實際上會生成 RegExp 實例，也可以直接建構 RegExp 實例：
&gt; 'Justin1Monica2Irene'.split(new RegExp('\d'))
[ 'J...">

    <meta property="og:locale" content="zh_TW">
    <meta property="og:title" content="RegExp 實例">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://openhome.cc/Gossip/Regex/RegExpJS.html">
    <meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
    <meta property="og:site_name" content="OPENHOME.CC">
    <meta property="og:description" content="規則表示式字面值實際上會生成 RegExp 實例，也可以直接建構 RegExp 實例：
&gt; 'Justin1Monica2Irene'.split(new RegExp('\d'))
[ 'J...">

    <title>RegExp 實例</title>

    <link rel="stylesheet" href="../css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="../css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="../css/caterpillar.css">
     <script async src="../google-code-prettify/run_prettify.js"></script>
     <!-- 網頁層級廣告 --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="RegExpJS.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">回 Regex</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a></div><br> <div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>RegExp 實例</h1>
        </header>

        <article class="content">
            <br><div class="ad-3" style="text-align: center;"><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
            <p>規則表示式字面值實際上會生成 <code>RegExp</code> 實例，也可以直接建構 <code>RegExp</code> 實例：</p>
<pre class="prettyprint"><code lang="javascript">&gt; 'Justin1Monica2Irene'.split(new RegExp('\\d'))
[ 'Justin', 'Monica', 'Irene' ]
</code></pre>
<p>使用建構式 <code>RegExp</code> 時必須指定字串，如果事先能決定表示式內容，使用字面值方式比較方便，若必須以動態地方式建構規則表示式，則可以使用字串方式來組合，然而必須注意到規則表示式中的一些字元，書寫為字串時必須轉譯（Escape）的問題。</p>
<p>例如，若有個字串是 <code>'Justin+Monica+Irene'</code>，想使用 <code>split</code> 方法依 <code>+</code> 切割，要使用的規則表示式是 <code>\+</code>，要將 <code>\+</code> 放至 <code>''</code> 之間時，必須忽略 <code>\+</code> 的 <code>\</code>，因而要撰寫為 <code>'\\+'</code>：</p>
<pre class="prettyprint"><code lang="javascript">&gt; 'Justin+Monica+Irene'.split(new RegExp('\\+'))
[ 'Justin', 'Monica', 'Irene' ]
</code></pre>
<p>類似地，如果有個字串是 <code>'Justin||Monica||Irene'</code>，想使用 <code>split</code> 方法依 <code>||</code> 切割，要使用的規則表示式是 <code>\|\|</code>，要將 <code>\|\|</code> 放至 <code>''</code>之間時，必須忽略 <code>\|</code> 的 <code>\</code>，就必須撰寫為 <code>'\\|\\|'</code>：</p>
<pre class="prettyprint"><code lang="javascript">&gt; 'Justin||Monica||Irene'.split(new RegExp('\\|\\|'))
[ 'Justin', 'Monica', 'Irene' ]
</code></pre>
<p>如果有個字串是 <code>'Justin\\Monica\\Irene'</code>，也就是原始文字是 <code>Justin\Monica\Irene</code> 的字串表示，若想使用 <code>split</code> 方法依 <code>\</code> 切割，要使用的規則表示式是 <code>\\</code>，那就得如下撰寫：</p>
<pre class="prettyprint"><code lang="javascript">&gt; 'Justin\\Monica\\Irene'.split(new RegExp('\\\\'))
[ 'Justin', 'Monica', 'Irene' ]
</code></pre>
<p>在使用建構式 <code>RegExp</code> 時，可以在第二個參數處指定旗標。例如：</p>
<pre class="prettyprint"><code lang="javascript">&gt; 'xfooxxxxxxfoo'.replace(new RegExp('.*?foo', 'g'), 'Orz')
'OrzOrz'
</code></pre>
<p>在建構 <code>RegExp</code> 時，也可以指定既有的 <code>RegExp</code> 實例，例如：</p>
<pre class="prettyprint"><code lang="javascript">const regex = new RegExp(/.*?foo/g); // 相當於 new RegExp('.*?foo', 'g')
</code></pre>
<p>在 ES6 中，還可以使用底下的方式（在只支援 ES5 環境中不行）：</p>
<pre class="prettyprint"><code lang="javascript">const regex = new RegExp(/.*?foo/, 'g');
</code></pre>
<p><code>RegExp</code> 的 <code>test</code> 方法，可用來搜尋、測試字串中是否有子字串符合規則表示式。例如：</p>
<pre class="prettyprint"><code lang="javascript">&gt; const regex1 = new RegExp('foo*');
undefined
&gt; console.log(regex1.test('table football'));
true
undefined
</code></pre>
<p>規則表示式實際上也是門語言，因而建立 <code>RegExp</code> 也是需要經過剖析到轉換至內部呈現格式等數個階段，為了效率考量，在可行的情況下，可重用已建立的 <code>RegExp</code>。</p>
<p>然而，JavaScript 的 <code>RegExp</code> 實際上是狀態可變的（Muttable），例如，在〈<a href="StringJS.html">String 與 RegExp</a>〉，就看過可修改 <code>lastIndex</code> 的值（為了示範黏性匹配）。</p>
<pre class="prettyprint"><code lang="javascript">&gt; const re = /.*?foo/y;
undefined
&gt; re.lastIndex = 4;
4
&gt; 'xfooxxxxxxfoo'.replace(re, 'Orz')
'xfooOrz'
</code></pre>
<p>一個代表規則表示式的物件是狀態可變的，就 API 設計上來說並不尋常，例如，若規則表示式被設置了全域旗標，<code>lastIndex</code> 就會有作用，預設值是 0，<code>test</code> 方法這時會以 <code>lastIndex</code> 作為測試的起點，如果比對到字串，<code>lastIndex</code> 就會設為比對到的字串後之索引，作為下個測試起點，如果沒有符合的字串，<code>lastIndex</code> 會回到 0。</p>
<p>因此，這就會有以下的怪異結果，明明就是相同字串，一個顯示 <code>true</code>，下一個卻顯示 <code>false</code>：</p>
<pre class="prettyprint"><code lang="javascript">&gt; const regex1 = new RegExp('foo*', 'g');
undefined
&gt; console.log(regex1.test('table football'));
true
undefined
&gt; console.log(regex1.test('table football'));
false
undefined
</code></pre>
<p><code>RegExp</code> 有個 <code>exec</code> 方法，類似 <code>String</code> 的 <code>match</code> 方法，如果有符合的字串，它會傳回一個陣列（否則傳回 <code>null</code>），第一個位置（索引 0）是符合的字串，而各分組捕捉到的值，逐一放在後續索引處。</p>
<p>如果分組使用了 <code>(?:...)</code> 就不會捕捉，傳回的陣列中也就不會有該分組的值。</p>
<pre class="prettyprint"><code lang="javascript">&gt; /(\d{4})-(\d{6})/.exec('0970-666888');
[ '0970-666888', '0970', '666888', index: 0, input: '0970-666888' ]
&gt; /(?:\d{4})-(?:\d{6})/.exec('0970-666888');
[ '0970-666888', index: 0, input: '0970-666888' ]
&gt; /(?:(\d{4})-(\d{6}))/.exec('0970-666888');
[ '0970-666888', '0970', '666888', index: 0, input: '0970-666888' ]
</code></pre>
<p>跟 <code>match</code> 不同的是，如果加上了全域旗標，那麼 <code>exec</code> 傳回的陣列，並不會是全部符合表示式的值：</p>
<pre class="prettyprint"><code lang="javascript">&gt; /((\d{4})-(\d{6}))/g.exec('0970-666888, 0970-168168');
[ '0970-666888',
  '0970-666888',
  '0970',
  '666888',
  index: 0,
  input: '0970-666888, 0970-168168' ]
&gt; /((\d{4})-(\d{6}))/g.exec('0970-666888, 0970-168168');
[ '0970-666888',
  '0970-666888',
  '0970',
  '666888',
  index: 0,
  input: '0970-666888, 0970-168168' ]
&gt; /((\d{4})-(\d{6}))/g.exec('0970-666888, 0970-168168');
[ '0970-666888',
  '0970-666888',
  '0970',
  '666888',
  index: 0,
  input: '0970-666888, 0970-168168' ]
</code></pre>
<p>蠻奇怪的不是嗎？稍微改一下，結果令人驚奇：</p>
<pre class="prettyprint"><code lang="javascript">&gt; const regex1 = /((\d{4})-(\d{6}))/g;
undefined
&gt; regex1.exec('0970-666888, 0970-168168')
[ '0970-666888',
  '0970-666888',
  '0970',
  '666888',
  index: 0,
  input: '0970-666888, 0970-168168' ]
&gt; regex1.exec('0970-666888, 0970-168168')
[ '0970-168168',
  '0970-168168',
  '0970',
  '168168',
  index: 13,
  input: '0970-666888, 0970-168168' ]
&gt; regex1.exec('0970-666888, 0970-168168')
null
</code></pre>
<p>記得嗎？<code>RegExp</code> 實際上是狀態可變的（Mutable），當啟用了全域旗標，<code>lastIndex</code> 會在比對到字串時變動，作為下個比對時的索引起點，因此，為了使用 <code>exec</code> 找出一個字串中全部符合規則表示式的子字串，就會有底下的方式：</p>
<pre class="prettyprint"><code lang="javascript">&gt; const regex1 = /((\d{4})-(\d{6}))/g;
undefined
&gt; var matched;
undefined
&gt; while((matched = regex1.exec('0970-666888, 0970-168168')) != null) {
...     console.log(`${matched[0]} found. The lastIndex is ${regex1.lastIndex}.`);
... }
0970-666888 found. The lastIndex is 11.
0970-168168 found. The lastIndex is 24.
undefined
</code></pre>
<p>用這個方式來找出全部符合的字串，其實是蠻詭異的，只能說，JavaScript 不單是語法，連 API 都設計地很隨性吧！</p>

            
           <br><br><div class="ad336-280" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article>
    </main>
</div></body>
</html>
<script src="../js/ui.js"></script>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
