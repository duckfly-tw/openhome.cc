<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="JSP 指示（Directive）元素的主要目的，在於指示容器將 JSP 轉譯為 Servlet 原始碼時，一些必須遵守的資訊。指示元素的語法如下所示：
&lt;%@ 指示類型 [屬性="值"]* %...">

    <meta property="og:locale" content="zh_TW">
    <meta property="og:title" content="指示元素">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://openhome.cc/Gossip/ServletJSP/DirectiveElement.html">
    <meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
    <meta property="og:site_name" content="OPENHOME.CC">
    <meta property="og:description" content="JSP 指示（Directive）元素的主要目的，在於指示容器將 JSP 轉譯為 Servlet 原始碼時，一些必須遵守的資訊。指示元素的語法如下所示：
&lt;%@ 指示類型 [屬性="值"]* %...">

    <title>指示元素</title>

    <link rel="stylesheet" href="../css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="../css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="../css/caterpillar.css">
     <script async src="../google-code-prettify/run_prettify.js"></script>
     <!-- 網頁層級廣告 --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="DirectiveElement.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">回 Servlet/JSP</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a> </div><br> <div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>指示元素</h1>
        </header>

        <article class="content">
            <br><div class="ad-3" style="text-align: center;"><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
            <p>JSP 指示（Directive）元素的主要目的，在於指示容器將 JSP 轉譯為 Servlet 原始碼時，一些必須遵守的資訊。指示元素的語法如下所示：</p>
<pre class="prettyprint"><code lang="java">&lt;%@ 指示類型 [屬性="值"]* %&gt;
</code></pre>
<p>在 JSP 中有三種常用的指示類型：<code>page</code>、<code>include</code> 與 <code>taglib</code>。</p>
<ul>
<li><code>page</code> 指示類型告知容器如何轉譯目前的 JSP 網頁。</li>
<li><code>include</code> 指示類型告知容器將別的 JSP 頁面包括進來進行轉譯。</li>
<li><code>taglib</code> 指示類型告知容器如何轉譯這個頁面中的標籤庫（Tag Library）。</li>
</ul>
<p>在這邊將先說明 <code>page</code> 與 <code>include</code> 指示類型的使用，<code>taglib</code> 則會在之後進行說明。</p>
<p>指示元素中可以有多對的屬性/ 值，必要時，同一個指示類型可以用數個指示元素來設定。直接以實際的例子來說明比較清楚。首先說明 <code>page</code> 指示類型：</p>
<pre class="prettyprint"><code lang="java">&lt;%@page import="java.time.*" %&gt;
&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;Page 指示元素&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;現在時間: &lt;%= LocalTime.now() %&gt; &lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><code>page</code> 指示類型的 <code>import</code> 屬性告知容器轉譯 JSP 時，必須在原始碼中包括的 <code>import</code> 陳述，範例中的 <code>import</code> 屬性的在轉譯後的 Servlet 原始碼會產生：</p>
<pre class="prettyprint"><code lang="java">import java.time.*;
</code></pre>
<p>你也可以在同一個 <code>import</code> 屬性中，使用逗號分隔數個 <code>import</code> 的內容：</p>
<pre class="prettyprint"><code lang="java">&lt;%@page import="java.time.*,cc.openhome.*" %&gt;
</code></pre>
<p><code>page</code> 指示類型的 <code>contentType</code> 屬性告知容器轉譯 JSP 時，必須使用 <code>HttpServletResponse</code> 的 <code>setContentType()</code>，呼叫方法時傳入的參數就是 <code>contentType</code> 的屬性值。<code>pageEncoding</code> 屬性則告知容器這個 JSP 網頁中的文字編碼，以及內容類型附加的 <code>charset</code> 設定。如果你的網頁中包括非 ASCII 編碼範圍中的字元（如中文），就要指定正確的編碼格式，才不會出現亂碼。根據 <code>contentType</code> 與 <code>pageEncoding</code> 屬性的設定，轉譯後的 Servlet 原始碼必須包括這行程式碼：</p>
<pre class="prettyprint"><code lang="java">response.setContentType("text/html;charset=UTF8");
</code></pre>
<p>可以在使用 <code>page</code> 類型時一行一行撰寫，也可以撰寫在同一個元素之中，例如：</p>
<pre class="prettyprint"><code lang="java">&lt;%@page import="java.time.*"
         contentType="text/html" pageEncoding="UTF-8" %&gt;
</code></pre>
<p><code>import</code>、<code>contentType</code> 與 <code>pageEncoding</code> 大概是你最常用到的三個屬性。<code>page</code> 指示類型還有一些可以設定的屬性，以下稍微作個說明，你不一定會全部用到，大致了解有這些屬性的存在即可。</p>
<ul>
<li><p><code>info</code></p>
<p>用於設定目前 JSP 頁面的基本資訊，這個資訊最後會轉換為 Servlet 程式中使用 <code>getServletInfo()</code> 所取得的資訊。</p>
</li>
<li><p><code>autoFlush</code></p>
<p>用於設定輸出串流是否要自動出清，預設是 <code>true</code>。如果設定為 <code>false</code>，而緩衝區滿了卻還沒呼叫 <code>flush()</code> 資料送出至客戶端，將會產生例外。</p>
</li>
<li><p><code>buffer</code></p>
<p>用於設定至客戶端的輸出串流緩衝區大小，設定時必須指定單位，例如 <code>buffer="16kb"</code>，預設是 8kb。</p>
</li>
<li><p><code>errorPage</code></p>
<p>用於設定當 JSP 執行錯誤而產生例外時，該轉發哪一個頁面處理這個例外，這在之後介紹「錯誤處理」時會加以說明。</p>
</li>
<li><p><code>extends</code></p>
<p>用來指定 JSP 網頁轉譯為 Servlet 程式之後，該繼承哪一個類別。以 Tomcat 為例，預設是繼承自 <code>HttpJspBase</code>（<code>HttpJspBase</code> 又繼承自 <code>HttpServlet</code>）。基本上你不會使用到這個屬性。</p>
</li>
<li><p><code>isErrorPage</code></p>
<p>設定 JSP 頁面是否為處理例外的頁面，這個屬性要與 <code>errorPage</code> 配合使用，這在之後介紹「錯誤處理」時會加以說明。</p>
</li>
<li><p><code>language</code></p>
<p>指定容器使用哪種語言的語法來轉譯 JSP 網頁，言下之意是 JSP 基本上可使用其它語言來轉譯，不過事實上目前只能使用 Java 的語法且是預設。</p>
</li>
<li><p><code>session</code></p>
<p>設定是否在轉譯後的 Servlet 原始碼中具有建立 <code>HttpSession</code> 物件的陳述句。預設是 <code>true</code>，若某些頁面不需作 Session 追蹤，設成 <code>false</code> 可以增加一些效能。</p>
</li>
<li><p><code>isELIgnored</code></p>
<p>設定 JSP 網頁中是否忽略運算式語言（Expression Language），預設是 <code>false</code>，如果設定為 <code>true</code>，則不轉譯運算式語言。這個設定會覆蓋 web.xml 中的 <code>&lt;el-ignored&gt;</code> 設定，運算式語言將於之後介紹。</p>
</li>
<li><p><code>isThreadSafe</code></p>
<p>告知容器你撰寫 JSP 時是否注意到執行緒安全，預設值是 <code>true</code>。如果設定為 <code>false</code>，則轉譯之後的 Servlet 會實作 <code>SingleThreadModel</code> 介面，每次請求時將建立一個 Servlet 實例來服務請求，雖然可以避免執行緒安全問題，這會引起效能問題，極度不建議設定為 <code>false</code>。</p>
</li>
</ul>
<p>接著介紹 <code>include</code> 指示類型，它用來告知容器包括另一個網頁的內容進行轉譯。直接來看個範例：</p>
<h4>includeDemo.jsp</h4>
<pre class="prettyprint"><code lang="java">&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;%@include file="/WEB-INF/jspf/header.jspf"%&gt;
    &lt;h1&gt;include 示範本體&lt;/h1&gt;
&lt;%@include file="/WEB-INF/jspf/foot.jspf"%&gt; 
</code></pre>
<p>上面這個程式在第一次執行時，將會把 header.jspf 與 foot.jspf 的內容包括進來作轉譯。假設這兩個檔案的內容分別是：</p>
<h4>header.jspf</h4>
<pre class="prettyprint"><code lang="java">&lt;%@ page pageEncoding="UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;include 示範開頭&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt; 
</code></pre>
<h4>foot.jspf</h4>
<pre class="prettyprint"><code lang="java">&lt;%@ page pageEncoding="UTF-8" %&gt;
    &lt;/body&gt;
&lt;/html&gt;  
</code></pre>
<p>實際執行時，容器會組合 includeDemo.jsp、header.jspf 與 foot.jspf 的內容後，再轉譯為 Servlet，也就是說，相當於轉譯這個 JSP：</p>
<pre class="prettyprint"><code lang="java">&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;include 示範開頭&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt; 
    &lt;h1&gt;include 示範本體&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt; 
</code></pre>
<p>所以最後會生成一個 Servlet（而不是三個），也就是說，使用指令元素 <code>include</code> 來包括其它網頁內容時，會在轉譯時期就決定轉譯後的 Servlet 內容，是一種靜態的指定方式。之後會介紹 <code>&lt;jsp:include&gt;</code> 標籤的使用，則是執行時期動態將別的網頁包括進來進行回應的方式，使用 <code>&lt;jsp:include&gt;</code> 的網頁與被 <code>&lt;jsp:include&gt;</code> 包括的網頁，各自都生成一個獨立的 Servlet。</p>
<p>你可以在 web.xml 中統一預設的網頁編碼、內容類型、緩衝區大小等，例如：</p>
<pre class="prettyprint"><code lang="java">&lt;web-app …&gt;
    …
    &lt;jsp-config&gt;
        &lt;jsp-property-group&gt;
            &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
            &lt;page-encoding&gt;UTF8&lt;/page-encoding&gt;
            &lt;default-content-type&gt;text/html&lt;/default-content-type&gt;
            &lt;buffer&gt;16kb&lt;/buffer&gt;
        &lt;/jsp-property-group&gt;
    &lt;/jsp-config&gt;
&lt;/web-app&gt;
</code></pre>
<p>也可以宣告指定的 JSP 開頭與結尾要包括的網頁：</p>
<pre class="prettyprint"><code lang="java">&lt;web-app …&gt;
    …
    &lt;jsp-config&gt;
        &lt;jsp-property-group&gt;
            &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
            &lt;include-prelude&gt;/WEB-INF/jspf/prelude1.jspf&lt;/include-prelude&gt;
            &lt;include-coda&gt;/WEB-INF/jspf/coda1.jspf&lt;/include-coda&gt;
        &lt;/jsp-property-group&gt;
    &lt;/jsp-config&gt;
&lt;/web-app&gt;
</code></pre>
<p>另外，注意到指示元素如果如下撰寫：</p>
<pre class="prettyprint"><code lang="java">&lt;%@page import="java.time.*" %&gt;
&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
Hello!
</code></pre>
<p>則產生的HTML會是：</p>
<pre class="prettyprint"><code lang="java">　　
　　
Hello!
</code></pre>
<p>因為在撰寫 JSP 指示元素時，換行了兩次，這兩次換行的字元也會輸出，一般來說這不會有什麼問題，但如果想要忽略這樣的換行，則可以在 web.xml　中設定：</p>
<pre class="prettyprint"><code lang="java">&lt;web-app …&gt;
    …
    &lt;jsp-config&gt;
        &lt;jsp-property-group&gt;
            &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
            &lt;trim-directive-whitespaces&gt;true&lt;/trim-directive-whitespaces&gt;
        &lt;/jsp-property-group&gt;
    &lt;/jsp-config&gt;
&lt;/web-app&gt;
</code></pre>

            
           <br><br><div class="ad336-280" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article>
    </main>
</div></body>
</html>
<script src="../js/ui.js"></script>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
