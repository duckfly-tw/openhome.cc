<!doctype html><html lang="zh-tw">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="在〈像素直線〉的最後，試著用像素直線來繪像素圓，結果並不是很理想，因為顯然有不對稱的地方，是的！不若隨意畫的直線，圓是對稱的，若想讓圓更好看一些，應該善用對稱。
對於這個問題，可以只畫出八分之一圓，然...">

    <meta property="og:locale" content="zh_TW">
    <meta property="og:title" content="像素圓">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://openhome.cc/Gossip/P5JS/PixelCircle.html">
    <meta property="og:image" content="https://openhome.cc/Gossip/images/caterpillar_small.jpg">
    <meta property="og:site_name" content="OPENHOME.CC">
    <meta property="og:description" content="在〈像素直線〉的最後，試著用像素直線來繪像素圓，結果並不是很理想，因為顯然有不對稱的地方，是的！不若隨意畫的直線，圓是對稱的，若想讓圓更好看一些，應該善用對稱。
對於這個問題，可以只畫出八分之一圓，然...">

    <title>像素圓</title>

    <link rel="stylesheet" href="../css/pure-0.6.0/pure-min.css">

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="../css/layouts/side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="../css/layouts/side-menu.css">
    <!--<![endif]-->
  

     <link rel="stylesheet" href="../css/caterpillar.css">
     <script async src="../google-code-prettify/run_prettify.js"></script>
     <!-- 網頁層級廣告 --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle =window.adsbygoogle || []).push({google_ad_client: "ca-pub-9750319131714390",enable_page_level_ads: true });</script></head>
<body>

<div id="layout">
    <!-- Menu toggle -->
    <a href="PixelCircle.html#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="index.html">回 p5.js</a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><br><div class="social" style="text-align: center;"><a href="http://twitter.com/caterpillar"><img title="Twitter" alt="Twitter" src="../images/twitter.png"></a> <a href="http://www.facebook.com/openhome.cc"><img title="Facebook" alt="Facebook" src="../images/facebook.png"></a></div><br> <div id="search box"><script>(function() {var cx = 'partner-pub-9750319131714390:3926766884';var gcse = document.createElement('script');gcse.type = 'text/javascript';gcse.async = true;gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse, s);})();</script><gcse:searchbox-only></gcse:searchbox-only></div><br><div class="ad" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 2015 新版型 160 x 600 廣告 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-9750319131714390"
     data-ad-slot="3747048883"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></li>
            </ul>
        </div>
    </div>

    <main id="main">
        <header class="header">
            <h1>像素圓</h1>
        </header>

        <article class="content">
            <br><div class="ad-3" style="text-align: center;"><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型回應式廣告 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="7104125683" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div> 
            
            <p>在〈<a href="PixelLine.html">像素直線</a>〉的最後，試著用像素直線來繪像素圓，結果並不是很理想，因為顯然有不對稱的地方，是的！不若隨意畫的直線，圓是對稱的，若想讓圓更好看一些，應該善用對稱。</p>
<p>對於這個問題，可以只畫出八分之一圓，然後其他以對稱方式處理就可以了，例如逆時針算出以上綠色的點就可以了：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/PixelCircle-1.JPG" alt="像素圓"  /></div></div></p>
<p>另一方面，並不需要將圓看成是正多邊形並繪製直線，如果要繪實心圓的話，因為圓的公式是 x<sup>2</sup> + y<sup>2</sup> = r<sup>2</sup>，可以單純地跑 (x, y)，只有在 (x, y) 於圓內時才畫出來，不過，若想繪製空心圓呢？</p>
<p>可以採用<a href="https://en.wikipedia.org/wiki/Midpoint_circle_algorithm">中點圓演算（Midpoint circle algorithm）</a>來解決，假設已經圓上第一個像素已經畫出，如下圖的綠色：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/PixelCircle-2.JPG" alt="像素圓"  /></div></div></p>
<p>這邊對半徑採四捨五入，因此對紅色圓或綠色圓，第一個像素都會是在上圖中的綠色區域，若是逆時針繪製，就往綠色左上角取 I、O 點，以及這兩點的中點 M，如果 M 點座標 (x, y)，x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup> &lt; 0，表示 M 在圓的內側，也就是圓比較靠 O 點，這時就畫出 O 點的像素，對於紅色圓與綠色圓，都可以畫出下圖：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/PixelCircle-3.JPG" alt="像素圓"  /></div></div></p>
<p>同樣地，現在 M 點座標也是在紅色圓與綠色圓內側，可以畫出下圖：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/PixelCircle-4.JPG" alt="像素圓"  /></div></div></p>
<p>對於紅色圓來說，如果 M 點座標 (x, y)，x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup> > 0，M 在紅色圓的外側，這表示圓比較靠 I 點，若是要繪紅色圓，應該畫出 I 點像素：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/PixelCircle-5.JPG" alt="像素圓"  /></div></div></p>
<p>對於藍色圓來說，M 在內側，這表示圓比較靠 O 點，若是要繪藍色圓，應該畫出 O 點像素：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/PixelCircle-6.JPG" alt="像素圓"  /></div></div></p>
<p>如果 M 正好在圓上呢？那就看你高興取 I 或 O，這篇文件後續會一律取 O，以上流程持續到 x &lt; -y 就可以停止了，因為只要算出八分之一圓，其餘就對稱處理。</p>
<p>x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup>  有用到平方計算，你要直接計算也是可以，不過實際上可以基於前一次的計算結果來化簡，不需用到平方計算，假設現在畫到以下狀態了：</p>
<p><div class="pure-g"><div class="pure-u-1"><img class="pure-img-responsive" src="images/PixelCircle-7.JPG" alt="像素圓"  /></div></div></p>
<p>上圖列出了目前像素左上座標，以及 I、M、O 點的座標，以 M 座標來計算 x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup>，就是 (xi - 1/2)<sup>2</sup> + (yi - 1)<sup>2</sup> - r<sup>2</sup>，若結果小於 0，那麼要選 O 作為下個像素點，其下個中點會是 (xi - 1/2, yi - 2)，套入 x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup> 的話，就是 (xi - 1/2)<sup>2</sup> + (yi - 2)<sup>2</sup> - r<sup>2</sup>，來比較這兩條公式：</p>
<pre class="prettyprint"><code lang="javascript">(xi - 1/2)<sup>2</sup> + (yi - 1)<sup>2</sup>- r<sup>2</sup>
(xi - 1/2)<sup>2</sup> + (yi - 2)<sup>2</sup> - r<sup>2</sup>
</code></pre>
<p>若整理一下上列的公式，如果你有前一次 x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup> 的運算結果 f，那麼下一次運算結果其實會是 f - 2 * cy + 3。</p>
<p>接著來看 (xi - 1/2)<sup>2</sup> + (yi - 1)<sup>2</sup> - r<sup>2</sup> 大於等於 0 的情況，這時要選 I 作為下個像素點，其下個中點會是 (xi - 1, yi - 1)，套入 x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup> 的話，就是 (xi - 3/2)<sup>2</sup> + (yi - 2)<sup>2</sup> - r<sup>2</sup>，來比較這兩條公式：</p>
<pre class="prettyprint"><code lang="javascript">(xi - 1/2)<sup>2</sup> + (yi - 1)<sup>2</sup> - r<sup>2</sup>
(xi - 3/2)<sup>2</sup> + (yi - 2)<sup>2</sup> - r<sup>2</sup>
</code></pre>
<p>若整理一下上列的公式，如果你有前一次 x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup> 的運算結果 f，那麼下一次運算結果其實會是 f - 2 * (cx + cy) + 5。</p>
<p>那麼首次的 f 呢？如果半徑是 r，第一個像素的座標會是 (r, 0)，套到 x<sup>2</sup> + y<sup>2</sup> - r<sup>2</sup>，計算後的結果會是 1.25 - 2 * r。</p>
<p>整理一下以上的結果，若最初像素座標 (x, y) 為 (r, 0)，逆時針畫八分之一圓，也就是到 x &lt; -y 停止繪製的話：</p>
<ul>
<li>最初的 f 是 1.25 - 2 * r。</li>
<li>若 f &lt; 0，下個像素座標會是 (x, y - 1)，下個 f 會是 f - 2 * cy + 3。</li>
<li>若 f >= 0，下個像素座標會是 (x - 1, y - 1)，下個 f 會是 f - 2 * (cx + cy) + 5。</li>
</ul>
<p>根據以上，可以寫出以下的 <code>pxCircle</code>：</p>
<script type="text/p5" data-p5-version="1.1.9" data-height="400" data-preview-width="400">function setup() {
	createCanvas(300, 300);
	noLoop();
}

function draw() {
	background(220);
	pxCircle(width / 2, height / 2, 20, 10);
}

function pxCircle(x, y, d, s) {
	push();
	translate(round(x), round(y));
  
	const r = round(d / 2);

	let cx = r;
	let cy = 0;
	let f = 1.25 - 2 * r;
	while(cx >= -cy) {
		const px = cx * s;
		const py = cy * s;
	  
		_pxCircleSquares(px, py, s);
	  
		cy = cy - 1;
		if(f >= 0) {
			cx = cx - 1;
			f = f - 2 * (cx + cy) + 5;
		}
		else {
			f = f - 2 * cy + 3;
		} 
	}
  
	pop();
}

// 基於 x, y 對稱繪製
function _pxCircleSquares(x, y, s) {
	square(x, y, s);
	square(x, -y, s);
	  
	square(-y, -x, s);
	square(-y, x, s);
	  
	square(-x, y, s);
	square(-x, -y, s);  
	  
	square(y, -x, s);
	square(y, x, s);  
}
</script>
<p>這樣就可以畫出圓來了，如果要填滿的圓，只要以對稱點來畫出直線就可以了：</p>
<script type="text/p5" data-p5-version="1.1.9" data-height="400" data-preview-width="400">function setup() {
	createCanvas(300, 300);
	noLoop();
}

function draw() {
	background(220);
	pxCircle(width / 2, height / 2, 20, 10);
}

let _pxNoFilled = false;
function pxFill() {
	_pxNoFilled = false;
}

function pxNoFill() {
	_pxNoFilled = true;
}

function pxCircle(x, y, d, s) {
	push();
	translate(round(x), round(y));
  
	const r = round(d / 2);

	let cx = r;
	let cy = 0;
	let f = 1.25 - 2 * r;
	while(cx >= -cy) {
		const px = cx * s;
		const py = cy * s;
	  
		_pxCircleSquares(px, py, s);
	  
		cy = cy - 1;
		if(f >= 0) {
			cx = cx - 1;
			f = f - 2 * (cx + cy) + 5;
		}
		else {
			f = f - 2 * cy + 3;
		} 
	}
  
	pop();
}

function _pxCircleSquares(x, y, s) {
	if(_pxNoFilled) {
		square(x, y, s);
		square(x, -y, s);
	  
		square(-y, -x, s);
		square(-y, x, s);
	  
		square(-x, y, s);
		square(-x, -y, s);  
	  
		square(y, -x, s);
		square(y, x, s);
	}
	else {
		for(let yi = y; yi <= -y; yi += s) {
			square(x, yi, s);
		}

		for(let yi = -x; yi <= x; yi += s) {
			square(-y, yi, s);
		}  
	  
		for(let yi = y; yi <= -y; yi += s) {
			square(-x, yi, s);
		}   

		for(let yi = -x; yi <= x; yi += s) {
			square(y, yi, s);
		}            
	}
}

</script>
<p>基本上，以上的計算方式，也可以推廣至橢圓或拋物線，有興趣可以自行嘗試。</p>

            
           <br><br><div class="ad336-280" style="text-align: center;"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 2015 新版型廣告 336 x 280 --><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9750319131714390" data-ad-slot="9976409681"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><br><div class="recommend" style="text-align: center;"><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 自動大小回應相符內容 --><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9750319131714390" data-ad-slot="4953478487" data-ad-format="autorelaxed"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
        </article>
    </main>
</div></body>
</html>
<script src="https://toolness.github.io/p5.js-widget/p5-widget.js"></script>
<script src="../js/ui.js"></script>
<div class="analytics"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QVQQYFSC8J"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-QVQQYFSC8J');</script></div>
